<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
    rel="stylesheet"
    as="style"
    crossorigin
    href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <link rel="stylesheet" href="/assets/css/popup/issueTotalPop.css" />
    <script src="https://code.jquery.com/jquery-latest.min.js"></script>
  </head>
  <body>
    <div id="issueTotalPopContent">
    <div class="issueTotalPopWrap">
      <div class="issueTotalPopContent">
        <div class="issueTotalPopTitles">
          <h5>현황 통계</h5>
          <button class="issueTotalcloseBtn">
            <img src="/assets/media/popup/issueTotalMedia/closeBtn.png" alt="close" />
         </button>
        </div>
        <div class="issueTotalSectionContDevide">
          <ul class="selectContent sectionMenuListBoxs">
            <li class="selectTitle"><p>발생지사</p></li>
            <!--수정부분 지사-->
            <div class="selectWrappers">
              <select
                name=""
                class="issueTotalHiddenSelect"
                id="issueTotalHiddenSelectBox01"
                multiple="multiple"
                hidden>
                <option value="전체">전체</option>
                <option value="지사1">지사1</option>
                <option value="지사2">지사2</option>
                <option value="지사3">지사3</option>
                <option value="지사4">지사4</option>
              </select>
            </div>
            <!--보여지는 셀렉박스-->
            <div class="surfaceSelects">
              <button class="issueTotalSelectsTitleBtn"></button>
              <div class="sufaceSelectList">
                <ul class="surfaceSelectListMember  checkBoxsContent"></ul>
              </div>
            </div>
          </ul>
          <ul class="selectContent sectionMenuListBoxs">
            <li class="selectTitle"><p>진행현황</p></li>
            <!--수정부분 지사-->
            <div class="selectWrappers">
              <select
                name=""
                class="issueTotalHiddenSelect"
                id="issueTotalHiddenSelectBox02"
                multiple="multiple"
                hidden>
                <option value="전체">전체</option>
                <option value="임시저장">임시저장</option>
                <option value="민원발생">민원발생</option>
                <option value="대응방안수립">대응방안수립</option>
                <option value="협의중">협의중</option>
                <option value="완료">완료</option>
              </select>
            </div>
            <!--보여지는 셀렉박스-->
            <div class="surfaceSelects">
              <button class="issueTotalSelectsTitleBtn"></button>
              <div class="sufaceSelectList">
                <ul class="surfaceSelectListMember"></ul>
              </div>
            </div>
          </ul>
          <ul class="selectContent sectionMenuListBoxs">
            <li class="selectTitle"><p>발생연월</p></li>
            <!--수정부분 지사-->
            <div class="selectWrappers">
              <select
                name=""
                class="issueTotalHiddenSelect"
                id="issueTotalHiddenSelectBox03"
                multiple="multiple"
                hidden>
                <option value="1월">1월</option>
                <option value="2월">2월</option>
                <option value="3월">3월</option>
                <option value="4월">4월</option>
                <option value="5월">5월</option>
                <option value="6월">6월</option>
                <option value="7월">7월</option>
                <option value="8월">8월</option>
                <option value="9월">9월</option>
                <option value="10월">10월</option>
                <option value="11월">11월</option>
                <option value="12월">12월</option>
              </select>
            </div>
            <!--보여지는 셀렉박스-->
            <div class="surfaceSelects">
              <button class="issueTotalSelectsTitleBtn"></button>
              <div class="sufaceSelectList">
                <ul class="surfaceSelectListMember selectChoice"></ul>
              </div>
            </div>
          </ul>
        </div>
        <div class="issueTotalDataWrapper">
          <div class="issueTotalDataScrollBoxs">
          <div class="issueDataTitleBoxs">
             <ul>
                <li><h5>민원발생</h5></li>
                <li><h5>대응방안수립</h5></li>
                <li><h5>협의중</h5></li>
                <li><h5>완료</h5></li>
             </ul>
          </div>
         <div class="issueDataBoxs">
             <img src="/assets/media/popup/issueTotalMedia/dataImg.png" alt="dataImg">
         </div>
         </div><!--issueTotalDataScrollBoxs-->
        </div>
      <div class="issueDataTextContent">
              <div class="issueDataTable">
                  <ul class="titles">
                     <li><p>구분</p></li>
                     <li><p>민원발생</p></li>
                     <li><p>대응방안수립</p></li>
                     <li><p>협의중</p></li>
                     <li><p>완료</p></li>
                  </ul>
                 <div class="issueDataTextScrollBoxs">
                  <ul class="datas">
                    <li><p>서울지사</p></li>
                    <li><p>3</p></li>
                    <li><p>14</p></li>
                    <li><p>0</p></li>
                    <li><p>0</p></li>
                  </ul>
                  <ul class="datas">
                    <li><p>경인지사</p></li>
                    <li><p>3</p></li>
                    <li><p>14</p></li>
                    <li><p>0</p></li>
                    <li><p>0</p></li>
                  </ul>
                  <ul class="datas">
                    <li><p>충청지사</p></li>
                    <li><p>3</p></li>
                    <li><p>14</p></li>
                    <li><p>0</p></li>
                    <li><p>0</p></li>
                  </ul>
                  <ul class="datas">
                    <li><p>대전지사</p></li>
                    <li><p>3</p></li>
                    <li><p>14</p></li>
                    <li><p>0</p></li>
                    <li><p>0</p></li>
                  </ul>
                  <ul class="datas">
                    <li><p>영남지사</p></li>
                    <li><p>3</p></li>
                    <li><p>14</p></li>
                    <li><p>0</p></li>
                    <li><p>0</p></li>
                  </ul>
                  <ul class="datas">
                    <li><p>영남지사</p></li>
                    <li><p>3</p></li>
                    <li><p>14</p></li>
                    <li><p>0</p></li>
                    <li><p>0</p></li>
                  </ul>
                  <ul class="datas">
                    <li><p>영남지사</p></li>
                    <li><p>3</p></li>
                    <li><p>14</p></li>
                    <li><p>0</p></li>
                    <li><p>0</p></li>
                  </ul>
                  <ul class="datas">
                    <li><p>영남지사</p></li>
                    <li><p>3</p></li>
                    <li><p>14</p></li>
                    <li><p>0</p></li>
                    <li><p>0</p></li>
                  </ul>
              </div>

          </div>
      </div>

      </div>

    </div>
  </div>
<script>

/* x표시 클릭시 닫기 */

const issueTotalcloseBtn = document.querySelector(".issueTotalcloseBtn");
const issueTotalPopContentWrap = document.getElementById("issueTotalPopContent");

if(issueTotalcloseBtn){
  issueTotalcloseBtn.addEventListener("click" , () => {
    issueTotalPopContentWrap.classList.remove("active");
  })
}

/* 셀렉트박스 함수 */

const issueTotalSelectEvet = () => {

 const issueTotalSelectsTitleBtn = document.querySelectorAll(".issueTotalPopWrap .issueTotalSelectsTitleBtn");
 const issueTotalSelectList = document.querySelectorAll(".issueTotalPopWrap .sufaceSelectList");
 const issueTotalSelectListMember = document.querySelectorAll(".issueTotalPopWrap .sufaceSelectList .surfaceSelectListMember");
 const issueTotalselectWrappers = document.querySelectorAll(".issueTotalHiddenSelect"); //셀렉박스


 let issueTotalAnswer = "";
 let issueTotalCheckAnswer = "";

 //셀렉버튼 최초값 함수
 const initialValues = () => {
     if(issueTotalselectWrappers.length > 0){
      for(let d = 0; d <= issueTotalselectWrappers.length - 1; d++){

         let issueTotalselectValuesInitial = issueTotalselectWrappers[d].children;
         issueTotalSelectsTitleBtn[d].innerText = issueTotalselectValuesInitial[0].value; //셀렉박스의 첫번째 값들이 surfaceSelectsTitleBtn값의 첫 값이 됨
         issueTotalselectWrappers[d].value = issueTotalSelectsTitleBtn[d].innerText; //셀렉박스의 value값을 surfaceSelectsTitleBtn값으로 설정
         
         if(issueTotalSelectListMember[d].classList.contains("selectChoice")){ 
            issueTotalSelectsTitleBtn[d].innerText = `선택`;
            }
     }
   }
 }

 if(issueTotalselectWrappers.length > 0){

 initialValues();//최초의값

 //체크박스가 아닐 경우, 셀렉박스 값  li p값에 담기 
 for(let i = 0; i <= issueTotalselectWrappers.length - 1; i++){
 
     const selectValues = issueTotalselectWrappers[i].children; //셀렉박스옵션값 

     for(let x = 0; x <= selectValues.length - 1; x++){

       issueTotalAnswer += `<li><p>${selectValues[x].value}</p></li>`;

         //체크박스가 있는 경우, 셀렉박스 값 li input p 값 이용
         if(issueTotalSelectListMember[i].classList.contains("checkBoxsContent")){ //체크박스
           issueTotalCheckAnswer += `<li>
             <input
               type="checkbox"
               id="issueTotalPopCheckBox0${x+1}"
               name="issueTotalPopCheck" />
             <label for="issueTotalPopCheckBox0${x+1}"></label><p>${selectValues[x].value}</p></li>`
         }
     }

     issueTotalSelectListMember[i].innerHTML = issueTotalSelectListMember[i].classList.contains("checkBoxsContent") ? issueTotalCheckAnswer : issueTotalAnswer;
     issueTotalAnswer = '';
     issueTotalCheckAnswer = '';
 }
}

issueTotalSelectsTitleBtn.forEach((btns, index) => {
       
    btns.addEventListener("click" , () => {
      const nextSiblings = btns.nextElementSibling;
 
      issueTotalSelectsTitleBtn.forEach((otherBtn) => {
       if (otherBtn !== btns) {
         otherBtn.classList.remove("active");
       }
      });
      btns.classList.toggle("active");
      nextSiblings.classList.toggle("active");
 
       //surfaceSelectList관련 toggle버튼
      issueTotalSelectList.forEach((box, boxIndex) => {
       //셀렉버튼의 인덱스와  surfaceSelectList 인덱스번호가 일치하면 메뉴를 오픈하고, btn에 active를 포함
       if (index === boxIndex) {
          box.classList.toggle(
             "active",
             btns.classList.contains("active")
          );
       } else {
          //그렇지 않으면 메뉴닫기
          box.classList.remove("active");
       }
       });
 
    });
   

    issueTotalSelectList.forEach((list) => {
       list.addEventListener("click" , (event) => {
        
         const thisBtns = event.target.parentElement.parentElement.parentElement.previousElementSibling;
         const selectContent =  event.target.parentElement.parentElement.parentElement.parentElement.previousElementSibling.children[0];//셀렉박스
         let currentSelect = selectContent.getAttribute("id");//셀렉박스아이디 가져오기
         
         if (event.target.nodeName === "P") {

             //빌생지사클릭시
             if( currentSelect === "issueTotalHiddenSelectBox01"){
                 return issueTotalSelectsTitleBtn.forEach((btn) => btn.classList.remove("active")),
                 issueTotalSelectList.forEach((lists) => lists.classList.remove("active"));
             }else{ 
                 let currentSelectValue = document.getElementById(currentSelect); //현재 셀렉박스 가져오기
                 return thisBtns.innerText = event.target.innerText,
                 $(currentSelectValue).val(event.target.innerText),//셀렉박스 값에 현재 클릭된 값의 텍스트 담기 
                 console.log(currentSelectValue.value), //셀렉박스값표시
                 issueTotalSelectsTitleBtn.forEach((btn) => btn.classList.remove("active")),
                 issueTotalSelectList.forEach((lists) => lists.classList.remove("active"));
             }

         }
             
         if(event.target.nodeName === "LABEL" || event.target.nodeName === "INPUT[TYPE='CHECKBOX']" ){ return; }


   });

 });
 
 
 })
}

issueTotalSelectEvet();


/* 체크박스 함수 */

const issueTatalCheckboxes = (checkboxes) =>  {
const issueTotalPopCheck = document.getElementsByName("issueTotalPopCheck");
checkboxes = issueTotalPopCheck;

const valuesArray = []; //셀렉박스 값 저장할 배열

if(checkboxes){
Array.from(checkboxes).forEach((checkBtn, index) => {

    //버튼 내 p값 가져오기 
    const values = checkBtn.nextElementSibling.nextElementSibling.innerText;

    checkBtn.addEventListener("change", () => {

        //체크박스를 체크했을 때
        if (checkBtn.checked) {
            // 첫 번째 체크박스가 체크되었을 때
            if (index === 0) {
                // 나머지 체크박스들의 체크 상태를 해제, 배열에서 제거
                for (let i = 1; i < checkboxes.length; i++) {
                    checkboxes[i].checked = false; // 체크 해제
                    const valueToRemove = checkboxes[i].nextElementSibling.nextElementSibling.innerText;
                    const indexToRemove = valuesArray.indexOf(valueToRemove);
                    if (indexToRemove !== -1) {
                        valuesArray.splice(indexToRemove, 1); // 배열에서 제거
                    }
                }
            } else {
                // 첫 번째 체크박스가 체크되어 있을 때, 다른 체크박스를 체크하면 첫 번째 체크박스 해제
                checkboxes[0].checked = false;
                const valueToRemove = checkboxes[0].nextElementSibling.nextElementSibling.innerText;
                const indexToRemove = valuesArray.indexOf(valueToRemove);
                if (indexToRemove !== -1) {
                    valuesArray.splice(indexToRemove, 1); // 배열에서 제거
                }
            }
            
            // 배열에 값 추가
            valuesArray.push(values);
        } else {
            // 체크박스가 체크 해제되었을 때 배열에서 값 제거
            const index = valuesArray.indexOf(values);
            if (index !== -1) {
                valuesArray.splice(index, 1);
            }
        }

        // 변경된 배열 값을 버튼의 텍스트에 삽입
        const displayElement = checkboxes[0].parentElement.parentElement.parentElement.previousElementSibling;
        displayElement.innerText = valuesArray.join(', '); // 배열을 문자열로 변환해서 출력

    });
});

}

}

issueTatalCheckboxes();

    </script>
  </body>
</html>
