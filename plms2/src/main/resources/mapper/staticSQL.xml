<?xml version="1.0" encoding= "UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="staticSQL">
<select id="searchStatisticsTojiCount" parameterType="HashMap" resultType="HashMap">


SELECT SUM(TT.CNT) AS CNT,
       TT.GUBUN,
       TT.TYPE
FROM (
    SELECT COUNT(*) AS CNT,
           SUBSTRING(PPI.CODE_DEPTH1, 1, 1) AS GUBUN,  -- SUBSTRING 사용, 인덱스 1부터 시작
           'ISSUE' AS TYPE
    FROM plms_POTENTIAL_ISSUE PPI
    LEFT JOIN (
        SELECT S.jm_pnu as PNU,
               S.jm_jisa as JISA,
               S.jm_JISANG_NO AS NO,
               RPAD(S.jm_ADDRCODE, 10, '0') AS ADDRCODE,
               S.jm_jibun as JIBUN
        FROM JISANG_MASTER S
        WHERE COALESCE(S.jm_CANCLE_YN, 'N') != 'Y'

        UNION ALL

        SELECT GP.gp_pnu as PNU,
               GM.gm_jisa as JISA,
               GM.gm_GOVER_NO AS JISANG_NO,
               GP.gp_addrcode as ADDRCODE,
               GP.gp_jibun as JIBUN
        FROM GOVER_PNU GP
        JOIN GOVER_POTENTIAL_ISSUE GPI ON GP.gp_GOVER_NO = GPI.GOVER_NO
        JOIN GOVER_MASTER GM ON GM.gm_GOVER_NO = GPI.GOVER_NO
        WHERE COALESCE(GM.gm_CANCLE_YN, 'N') != 'Y'

        UNION ALL

        SELECT S3.nm_pnu as PNU,
               S3.nm_jisa as JISA,
               S3.nm_NOTSET_NO AS NO,
               RPAD(S3.nm_ADDRCODE, 10, '0') AS ADDRCODE,
               S3.nm_jibun as JIBUN
        FROM NOTSET_MASTER S3
        WHERE S3.nm_DEL_FLAG != 'Y'
    ) T ON PPI.addrcode = T.ADDRCODE AND PPI.JIBUN = T.JIBUN
    WHERE PPI.DEL_FLAG != 'Y'
      AND PPI.CODE_DEPTH3 != 'DY010101'
      AND PPI.CODE_DEPTH2 NOT IN ('GY010100', 'GY020100')
      <if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(JISA)" > 
   		AND T.JISA = #{JISA}
	  </if> 
    GROUP BY SUBSTRING(PPI.CODE_DEPTH1, 1, 1)

    UNION ALL

    SELECT COUNT(*) AS CNT,
           SUBSTRING(A.mm_MW_CODE1, 1, 1) AS GUBUN,
           'MINWON' AS TYPE
    FROM MINWON_MASTER A
    JOIN MINWON_PNU B ON A.mm_MW_SEQ = B.mp_MINWON_SEQ
    LEFT JOIN JIJUK_2024 JM ON B.mp_PNU = JM.PNU
    WHERE A.mm_DEL_FLAG != 'Y'
      AND A.mm_STATUS IN ('3', '4')
      AND A.mm_MW_CODE3 != 'DY010101'
      AND A.mm_MW_CODE2 NOT IN ('GY010100', 'GY020100')
      <if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(JISA)" > 
   AND A.mm_JISA = #{JISA}
		    </if> 
    GROUP BY SUBSTRING(A.mm_MW_CODE1, 1, 1)

    UNION ALL

    SELECT COUNT(*) AS CNT,
           SUBSTRING(GPI.CODE_DEPTH1, 1, 1) AS GUBUN,
           'ISSUE' AS TYPE
    FROM GOVER_POTENTIAL_ISSUE GPI
    LEFT JOIN (
        SELECT GP.gp_pnu as PNU,
               GM.gm_jisa as JISA,
               GM.gm_GOVER_NO AS JISANG_NO,
               GP.gp_addrcode as ADDRCODE,
               GP.gp_jibun as JIBUN
        FROM GOVER_PNU GP
        JOIN GOVER_POTENTIAL_ISSUE GPI ON GP.gp_GOVER_NO = GPI.GOVER_NO
        JOIN GOVER_MASTER GM ON GM.gm_GOVER_NO = GPI.GOVER_NO
        WHERE COALESCE(GM.gm_CANCLE_YN, 'N') != 'Y'
    ) T ON GPI.GOVER_NO = T.JISANG_NO
    WHERE GPI.DEL_FLAG != 'Y'
      AND GPI.CODE_DEPTH3 != 'DY010101'
      AND GPI.CODE_DEPTH2 NOT IN ('GY010100', 'GY020100')
      <if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(JISA)" > 
   AND T.JISA = #{JISA}
		    </if> 
    GROUP BY SUBSTRING(GPI.CODE_DEPTH1, 1, 1)
) TT
GROUP BY TT.GUBUN, TT.TYPE





	</select>
	
	<!-- 권리확보현황 마감처리 데이터 저장 -->
	<insert id="insertStatisticsDeadlineProcess" parameterType="HashMap"> 
INSERT INTO JISANG_STAT (
        SEQ,
        SAVE_YEAR,
        SAVE_QUARTER,
        SAVE_DATE,
        PROCESS_DATE,
        SAYUJI_N,
        SAYUJI_Y_Y,
        SAYUJI_Y_N,
        SAYUJI_TOTAL,
        GUKYUJI_Y,
        GUKYUJI_J,
        GUKYUJI_N,
        GUKYUJI_TOTAL,
        FILE_PATH,
        FILE_NAME
) VALUES (
        (SELECT NVL(MAX(SEQ), 0) + 1 FROM JISANG_STAT S),
        #{SAVE_YEAR},
        #{SAVE_QUARTER},
        Now(),
        #{PROCESS_DATE},
        #{SAYUJI_N},
        #{SAYUJI_Y_Y},
        #{SAYUJI_Y_N}
        #{SAYUJI_TOTAL}
        #{GUKYUJI_Y}
        #{GUKYUJI_J}
        #{GUKYUJI_N}
        #{GUKYUJI_TOTAL}
        #{FILE_PATH}
        #{FILE_NAME}
)
	</insert>
	
	
<!--  점용허가 현황 엑셀 다운로드 쿼리  LJS-->

	<select id="selectNewGoverStaticList" parameterType="HashMap" resultType="HashMap">
	

SELECT DISTINCT(MASTER_NO)
    , JISA
    , COALESCE(NEWREGREASON, '') AS NEWREGREASON
    , COALESCE(OCCUNONPAYREASON, '') AS OCCUNONPAYREASON
    , COALESCE(PERMPOSSYN, 'N') AS PERMPOSSYN
    , COALESCE(OCCUPREPAYYN, '') AS OCCUPREPAYYN
    , OCCUPREPAYDATE
    , PCOUNT
    , PAY_DATE
    , PMT_ST_DATE
    , PMT_ED_DATE
FROM (
    SELECT T.*
    FROM (
        SELECT
            COALESCE(NEWREGREASON, '') AS NEWREGREASON
            , COALESCE(OCCUNONPAYREASON, '') AS OCCUNONPAYREASON
            , COALESCE(PERMPOSSYN, 'N') AS PERMPOSSYN
            , COALESCE(OCCUPREPAYYN, '') AS OCCUPREPAYYN
            , TO_CHAR(OCCUPREPAYDATE, 'YYYY-MM-DD') AS OCCUPREPAYDATE
            , PCOUNT
            , ROW_NUMBER() OVER (ORDER BY JIJUK_MST.PNU DESC) AS RNO
            , ROW_NUMBER() OVER (ORDER BY JIJUK_MST.PNU ASC) AS RN
            , JOIN_MST.SIDO_NM
            , JOIN_MST.SGG_NM
            , JOIN_MST.EMD_NM
            , JOIN_MST.RI_NM
            , JOIN_MST.JIBUN
            , JIJUK_MST.JIBUN_FULL
            , JIJUK_MST.JIMOK_TEXT
            , JOIN_MST.PNU
            , JOIN_MST.ADDRCODE
            , JIJUK_MST.DOSIPLAN
            , COALESCE(JOIN_MST.GOVER_OWN_YN, 'N') AS GOVER_OWN_YN
            , JIJUK_MST.JIJUK_AREA
            , JOIN_MST.JIJUK_AREA AS AREA
            , JOIN_MST.JISANG_STATUS
            , JOIN_MST.JASAN_NO
            , JOIN_MST.CHUIDEUK_DATE
            , COALESCE(JIJUK_MST.PIPE_OVERLAP_YN, 'N') AS PIPE_OVERLAP_YN
            , JOIN_MST.MASTER_NO
            , JOIN_MST.COMPLE_YN AS JISANG_COMPLE_YN
            , JOIN_MST.PERMITTED_YN AS JISANG_PERMITTED_YN
            , JOIN_MST.JISA
            , JOIN_MST.PMT_NO
            , JOIN_MST.PAY_MONEY
            , JOIN_MST.PAY_DATE
            , JOIN_MST.PMT_ST_DATE
            , JOIN_MST.PMT_ED_DATE
            , JOIN_MST.CHUIDEUK_MONEY
            , JOIN_MST.GOVER_LENGTH
            , JOIN_MST.GOVER_AREA
            , JOIN_MST.PIPE_METER
            , JOIN_MST.PIPE_METER2
            , JOIN_MST.SOUJA_NAME
            , JOIN_MST.SOUJA_CNT
            , JOIN_MST.JASAN_MONEY
            , CASE 
                WHEN JOIN_MST.JISANG_STATUS != 'GOVER' THEN PPI.REGISTED_YN 
                ELSE GPI.REGISTED_YN 
              END AS REGISTED_YN
            , CASE 
                WHEN JOIN_MST.JISANG_STATUS != 'GOVER' THEN PPI.PERMITTED_YN 
                ELSE GPI.PERMITTED_YN 
              END AS PERMITTED_YN
            , CASE 
                WHEN JOIN_MST.JISANG_STATUS != 'GOVER' THEN PPI.CODE_DEPTH1 
                ELSE GPI.CODE_DEPTH1 
              END AS CODE_DEPTH1
            , CASE 
                WHEN JOIN_MST.JISANG_STATUS != 'GOVER' THEN PPI.CODE_DEPTH2 
                ELSE GPI.CODE_DEPTH2 
              END AS CODE_DEPTH2
            , CASE 
                WHEN JOIN_MST.JISANG_STATUS != 'GOVER' THEN PPI.CODE_DEPTH3 
                ELSE GPI.CODE_DEPTH3 
              END AS CODE_DEPTH3
            , GPI.LNEWREG
            , GPI.LPERMITIONYN
            , GPI.LOCCUP_FEE
            , GPI.lperpay as LPREPAY
        FROM JIJUK_2024 JIJUK_MST
        LEFT JOIN (
            SELECT 
                '' AS NEWREGREASON
                , '' AS OCCUNONPAYREASON
                , '' AS PERMPOSSYN
                , '' AS OCCUPREPAYYN
                , NULL AS OCCUPREPAYDATE
                , NULL AS PCOUNT
                , JM.jm_JISANG_NO AS MASTER_NO
                , 'JISANG' AS JISANG_STATUS
                , JM.jm_jisa as JISA
                , JM.jm_sido_nm as SIDO_NM
                , JM.jm_sgg_nm as SGG_NM
                , JM.jm_emd_nm as EMD_NM
                , JM.jm_ri_nm as RI_NM
                , JM.jm_jibun as JIBUN
                , JM.jm_pnu as PNU
                , JM.jm_addrcode as ADDRCODE
                , JM.jm_jasan_no as JASAN_NO
                , TO_CHAR(JM.jm_CHUIDEUK_DATE, 'YYYY-MM-DD') AS CHUIDEUK_DATE
                , JM.jm_chuideuk_money as CHUIDEUK_MONEY
                , JM.jm_jasan_money as JASAN_MONEY
                , NULL AS PMT_NO
                , NULL AS PAY_MONEY
                , NULL AS PAY_DATE
                , NULL AS PMT_ST_DATE
                , NULL AS PMT_ED_DATE
                , NULL AS GOVER_LENGTH
                , JM.jm_PYEONIB_AREA + COALESCE((SELECT SUM(S.jm_PYEONIB_AREA) FROM JISANG_MERGE S WHERE S.jm_REP_JISANG_NO = JM.jm_JISANG_NO), 0) AS GOVER_AREA
                , NULL AS PIPE_METER
                , NULL AS PIPE_METER2
                , JS.SOUJA_NAME
                , (SELECT COUNT(js_JISANG_NO) - 1 FROM JISANG_SOUJA WHERE js_JISANG_NO = JM.jm_JISANG_NO) AS SOUJA_CNT
                , JM.jm_gover_own_yn as GOVER_OWN_YN
                , JM.jm_jijuk_area as JIJUK_AREA
                , JM.jm_comple_yn as COMPLE_YN
                , JM.jm_permitted_yn as PERMITTED_YN
            FROM JISANG_MASTER JM
            LEFT JOIN (
                SELECT *
                FROM (
                    SELECT js_jisang_no as JISANG_NO, js_souja_name as SOUJA_NAME, ROW_NUMBER() OVER (PARTITION BY js_JISANG_NO ORDER BY js_JISANG_NO ASC) AS ROW_IDX
                    FROM JISANG_SOUJA
                    GROUP BY js_JISANG_NO, js_SOUJA_NAME
                ) AS sub1 WHERE ROW_IDX = 1
            ) JS ON JM.jm_JISANG_NO = JS.JISANG_NO
            WHERE (JM.jm_CANCLE_YN IS NULL OR JM.jm_CANCLE_YN != 'Y')
            
            UNION ALL
            
            SELECT
                GM.gm_NEWREGREASON AS NEWREGREASON
                , GM.gm_OCCUNONPAYREASON AS OCCUNONPAYREASON
                , GM.gm_PERMPOSSYN AS PERMPOSSYN
                , GM.gm_OCCUPREPAYYN AS OCCUPREPAYYN
                , GM.gm_OCCUPREPAYDATE AS OCCUPREPAYDATE
                , (SELECT COUNT(*) FROM GOVER_PNU GP1 WHERE GP1.gp_GOVER_NO = GP.gp_GOVER_NO) AS PCOUNT
                , GP.gp_GOVER_NO AS MASTER_NO
                , 'GOVER' AS JISANG_STATUS
                , (SELECT S.gm_JISA FROM GOVER_MASTER S WHERE S.gm_GOVER_NO = GP.gp_GOVER_NO) AS JISA
                , GP.gp_sido_nm as SIDO_NM
                , GP.gp_sgg_nm as SGG_NM
                , GP.gp_emd_nm as EMD_NM
                , GP.gp_ri_nm as RI_NM
                , GP.gp_jibun as JIBUN
                , GP.gp_pnu as PNU
                , GP.gp_addrcode as ADDRCODE
                , NULL AS JASAN_NO
                , NULL AS CHUIDEUK_DATE
                , NULL AS CHUIDEUK_MONEY
                , NULL AS JASAN_MONEY
                , GPE.PMT_NO
                , GPE.PAY_MONEY
                , TO_CHAR(GPE.PAY_DATE, 'YYYY-MM-DD') AS PAY_DATE
                , TO_CHAR(GM.gm_GOVER_ST_DATE, 'YYYY-MM-DD') AS PMT_ST_DATE
                , TO_CHAR(GM.gm_GOVER_ED_DATE, 'YYYY-MM-DD') AS PMT_ED_DATE
                , GP.gp_gover_length as GOVER_LENGTH
                , GP.gp_gover_area as GOVER_AREA
                , (SELECT S.gm_pipe_meter as PIPE_METER FROM GOVER_MASTER S WHERE S.gm_GOVER_NO = GP.gp_GOVER_NO) AS PIPE_METER
                , (SELECT S.gm_pipe_meter2 as PIPE_METER2 FROM GOVER_MASTER S WHERE S.gm_GOVER_NO = GP.gp_GOVER_NO) AS PIPE_METER2
                , NULL AS SOUJA_NAME
                , 0 AS SOUJA_CNT
                , GP.gp_gover_own_yn as GOVER_OWN_YN
                , GP.gp_jijuk_area as JIJUK_AREA
                , '' AS COMPLE_YN
                , '' AS PERMITTED_YN
            FROM GOVER_PNU GP
            LEFT JOIN (
                SELECT S.gp_gover_no as GOVER_NO
                    , S.gp_pay_money as PAY_MONEY
                    , S.gp_pay_vat as PAY_VAT
                    , S.gp_pay_date as PAY_DATE
                    , S.gp_pay_way as PAY_WAY
                    , S.gp_pmt_no as PMT_NO
                    , S.gp_pmt_st_date as PMT_ST_DATE
                    , S.gp_pmt_ed_date as PMT_ED_DATE
                FROM GOVER_PERMIT S
                INNER JOIN (
                    SELECT MAX(SS.gp_SEQ) AS SEQ
                        , SS.gp_gover_no as GOVER_NO
                    FROM GOVER_PERMIT SS
                    WHERE SS.gp_PMT_NO IS NOT NULL
                    AND SS.gp_DOCKEY IN (
                        SELECT SSS.pa_DOCKEY
                        FROM PLMS_APPROVAL SSS
                        WHERE SSS.pa_STATUS IS NOT NULL
                        AND SSS.pa_STATUS != 'X'
                    )
                    GROUP BY SS.gp_GOVER_NO
                ) SS ON S.gp_SEQ = SS.SEQ AND S.gp_GOVER_NO = SS.GOVER_NO
            ) GPE ON GP.gp_GOVER_NO = GPE.GOVER_NO
            LEFT JOIN GOVER_MASTER GM ON GP.gp_GOVER_NO = GM.gm_GOVER_NO
            WHERE GM.gm_SAVE_STATUS = 'A' AND GM.gm_CANCLE_YN IS NULL
            
            UNION ALL
            
            SELECT
                '' AS NEWREGREASON
                , '' AS OCCUNONPAYREASON
                , '' AS PERMPOSSYN
                , '' AS OCCUPREPAYYN
                , NULL AS OCCUPREPAYDATE
                , 0 AS PCOUNT
                , NM.nm_NOTSET_NO AS MASTER_NO
                , 'NOTSET' AS JISANG_STATUS
                , NM.nm_jisa as JISA
                , NM.nm_sido_nm as SIDO_NM
                , NM.nm_sgg_nm as SGG_NM
                , NM.nm_emd_nm as EMD_NM
                , NM.nm_ri_nm as RI_NM
                , NM.nm_jibun as JIBUN
                , NM.nm_pnu as PNU
                , NM.nm_addrcode as ADDRCODE
                , NULL AS JASAN_NO
                , NULL AS CHUIDEUK_DATE
                , NULL AS CHUIDEUK_MONEY
                , NULL AS JASAN_MONEY
                , NULL AS PMT_NO
                , NULL AS PAY_MONEY
                , NULL AS PAY_DATE
                , NULL AS PMT_ST_DATE
                , NULL AS PMT_ED_DATE
                , NULL AS GOVER_LENGTH
                , NULL AS GOVER_AREA
                , NULL AS PIPE_METER
                , NULL AS PIPE_METER2
                , NS.souja_name as SOUJA_NAME
                , (SELECT COUNT(ns_NOTSET_NO) - 1 FROM NOTSET_SOUJA WHERE ns_NOTSET_NO = NM.nm_NOTSET_NO) AS SOUJA_CNT
                , NM.nm_gover_own_yn as GOVER_OWN_YN
                , NM.nm_jijuk_area as JIJUK_AREA
                , '' AS COMPLE_YN
                , '' AS PERMITTED_YN
            FROM NOTSET_MASTER NM
            LEFT JOIN (
                SELECT *
                FROM (
                    SELECT ns_notset_no as NOTSET_NO, ns_souja_name as SOUJA_NAME, ROW_NUMBER() OVER (PARTITION BY ns_NOTSET_NO ORDER BY ns_NOTSET_NO ASC) AS ROW_IDX
                    FROM NOTSET_SOUJA
                    GROUP BY ns_NOTSET_NO, ns_SOUJA_NAME
                ) AS sub2 WHERE ROW_IDX = 1
            ) NS ON NM.nm_NOTSET_NO = NS.NOTSET_NO
            WHERE NM.nm_DEL_FLAG = 'N'
            
            UNION ALL
            
            SELECT
                '' AS NEWREGREASON
                , '' AS OCCUNONPAYREASON
                , '' AS PERMPOSSYN
                , '' AS OCCUPREPAYYN
                , NULL AS OCCUPREPAYDATE
                 , 0 AS PCOUNT
                , DM.dom_DOPCO_NO AS MASTER_NO
                , 'DOPCO' AS JISANG_STATUS
                , DM.dom_jisa as JISA
                , DM.dom_sido_nm as SIDO_NM
                , DM.dom_sgg_nm as SGG_NM
                , DM.dom_emd_nm as EMD_NM
                , DM.dom_ri_nm as RI_NM
                , DM.dom_jibun as JIBUN
                , DM.dom_pnu as PNU
                , DM.dom_addrcode as ADDRCODE
                , DM.dom_jasan_no as JASAN_NO
                , TO_CHAR(DM.dom_DEUNGGI_DATE, 'YYYY-MM-DD') AS CHUIDEUK_DATE
                , NULL AS CHUIDEUK_MONEY
                , DM.dom_JASAN_MONEY::numeric AS JASAN_MONEY
                , NULL AS PMT_NO
                , NULL AS PAY_MONEY
                , NULL AS PAY_DATE
                , NULL AS PMT_ST_DATE
                , NULL AS PMT_ED_DATE
                , NULL AS GOVER_LENGTH
                , NULL AS GOVER_AREA
                , NULL AS PIPE_METER
                , NULL AS PIPE_METER2
                , DM.dom_souja_name as SOUJA_NAME
                , 0 AS SOUJA_CNT
                , DM.dom_gover_own_yn as GOVER_OWN_YN
                , DM.dom_jijuk_area as JIJUK_AREA
                , '' AS COMPLE_YN
                , '' AS PERMITTED_YN
            FROM DOPCO_MASTER DM
            WHERE DM.dom_CANCLE_YN IS NULL
        ) JOIN_MST ON JOIN_MST.PNU = JIJUK_MST.PNU
        LEFT JOIN (
            SELECT S.*
            FROM (
                SELECT RANK() OVER (PARTITION BY RPAD(PPI.addrcode, 10, '0'), PPI.JIBUN ORDER BY PPI.ISSUE_DATE DESC) AS RANK
                    , RPAD(PPI.addrcode, 10, '0') AS ADDRCODE
                    , PPI.jibun as JIBUN
                    , PPI.code_depth1 as CODE_DEPTH1
                    , PPI.code_depth2 as CODE_DEPTH2
                    , PPI.code_depth3 as CODE_DEPTH3
                    , PPI.registed_yn as REGISTED_YN
                    , PPI.permitted_yn as PERMITTED_YN
                    , PPI.pnu as PNU
                    , PPI.del_flag as DEL_FLAG
                FROM plms_POTENTIAL_ISSUE PPI
                WHERE PPI.DEL_FLAG != 'Y'
            ) S WHERE S.RANK = 1
        ) PPI ON RPAD(JOIN_MST.ADDRCODE, 10, '0') = PPI.ADDRCODE AND JOIN_MST.JIBUN = PPI.JIBUN
        LEFT JOIN GOVER_POTENTIAL_ISSUE GPI ON JOIN_MST.MASTER_NO = GPI.GOVER_NO AND GPI.DEL_FLAG != 'Y'
    ) T
    WHERE 1=1
) R
WHERE 1=1;

  <if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(JISA)" > 
   		
  		and R.JISA=#{JISA} 
		
	</if>
	</select>

	<select id="selectIssueStatisticsData" parameterType="HashMap" resultType="HashMap">
SELECT TTT.TYPE,
       COALESCE(TTT.REGISTED_YN, 'NONE') AS REGISTED_YN,
       COALESCE(TTT.PERMITTED_YN, 'NONE') AS PERMITTED_YN,
       TTT.DEPTH1,
       TTT.DEPTH2,
       TTT.DEPTH3,
       TTT.DEPTH1_NAME,
       TTT.DEPTH2_NAME,
       TTT.DEPTH3_NAME,
       TTT.POTENTIAL_ISSUE_CNT,
       TTT.MINWON_CNT,
       ROUND(COALESCE(TTT.MINWON_CNT / NULLIF(TTT.MINWON_TOTAL_CNT, 0), 0) * 100, 2) AS MINWON_PERCENT,
       ROUND(COALESCE(TTT.POTENTIAL_ISSUE_CNT / NULLIF(TTT.PPI_TOTAL, 0), 0) * 100, 2) AS PPI_PER,
       TTT.PPI_TOTAL,
       TTT.MINWON_TOTAL_CNT
  FROM (
    SELECT TT.TYPE,
           TT.REGISTED_YN,
           TT.PERMITTED_YN,
           TT.DEPTH1,
           TT.DEPTH2,
           TT.DEPTH3,
           TT.DEPTH1_NAME,
           TT.DEPTH2_NAME,
           TT.DEPTH3_NAME,
           TT.POTENTIAL_ISSUE_CNT,
           SUM(TT.POTENTIAL_ISSUE_CNT) OVER () AS PPI_TOTAL,
           TT.MINWON_CNT,
           SUM(TT.MINWON_CNT) OVER () AS MINWON_TOTAL_CNT
      FROM (
        SELECT SUBSTRING(TN.DEPTH3, 1, 1) AS TYPE,
               TN.DEPTH1,
               TN.DEPTH2,
               TN.DEPTH3,
               COALESCE(PIC1.CODE_NAME, '이슈유형 미매칭') AS DEPTH1_NAME,
               COALESCE(PIC2.CODE_NAME, '이슈유형 미매칭') AS DEPTH2_NAME,
               COALESCE(TN.DEPTH3_NAME, '이슈유형 미매칭') AS DEPTH3_NAME,
               COUNT(T.MASTER_NO) AS POTENTIAL_ISSUE_CNT,
               (
                 SELECT COUNT(*)
                   FROM MINWON_MASTER MM
                  WHERE TN.DEPTH1 = COALESCE(MM.mm_MW_CODE1, 'NONE')
                    AND TN.DEPTH2 = COALESCE(MM.mm_MW_CODE2, 'NONE')
                    AND TN.DEPTH3 = COALESCE(MM.mm_MW_CODE3, 'NONE')
                    AND MM.mm_DEL_FLAG != 'Y'
                    AND MM.mm_STATUS IN ('2', '3', '4')
        <if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(SEARCH_START_DAY)" > 
            AND MM.mm_MW_OCCUR_DATE >= #{SEARCH_START_DAY}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(SEARCH_END_DAY)" > 
            AND MM.mm_MW_OCCUR_DATE &lt;= to_date(#{SEARCH_END_DAY},'YYYYMMDD')
		</if>
		
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(SEARCH_STATUS)" > 
            AND MM.mm_STATUS = #{SEARCH_STATUS}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(SEARCH_JISA)" > 
            AND MM.mm_JISA = #{SEARCH_JISA}
		</if> 
               ) AS MINWON_CNT,
               TN.REGISTED_YN,
               TN.PERMITTED_YN
          FROM (
            SELECT JOIN_MST.MASTER_NO,
                   JOIN_MST.SIDO_NM,
                   JOIN_MST.SGG_NM,
                   JOIN_MST.EMD_NM,
                   JOIN_MST.RI_NM,
                   JOIN_MST.JIBUN,
                   JOIN_MST.PNU,
                   JOIN_MST.ADDRCODE,
                   JOIN_MST.JISANG_STATUS,
                   CASE
                     WHEN JOIN_MST.JISANG_STATUS != 'GOVER' THEN PPI.REGISTED_YN
                     ELSE PPI.REGISTED_YN
                   END AS REGISTED_YN,
                   CASE
                     WHEN JOIN_MST.JISANG_STATUS != 'GOVER' THEN PPI.PERMITTED_YN
                     ELSE PPI.PERMITTED_YN
                   END AS PERMITTED_YN,
                   COALESCE(CASE
                     WHEN JOIN_MST.JISANG_STATUS != 'GOVER' THEN PPI.CODE_DEPTH1
                     ELSE PPI.CODE_DEPTH1
                   END, 'NONE') AS CODE_DEPTH1,
                   COALESCE(CASE
                     WHEN JOIN_MST.JISANG_STATUS != 'GOVER' THEN PPI.CODE_DEPTH2
                     ELSE PPI.CODE_DEPTH2
                   END, 'NONE') AS CODE_DEPTH2,
                   COALESCE(CASE
                     WHEN JOIN_MST.JISANG_STATUS != 'GOVER' THEN PPI.CODE_DEPTH3
                     ELSE PPI.CODE_DEPTH3
                   END, 'NONE') AS CODE_DEPTH3
              FROM JIJUK_2024 JIJUK_MST
              LEFT JOIN (
                SELECT JM.jm_JISANG_NO AS MASTER_NO,
                       'JISANG' AS JISANG_STATUS,
                       JM.jm_jisa as JISA,
                       JM.jm_sido_nm as SIDO_NM,
                       JM.jm_sgg_nm as SGG_NM,
                       JM.jm_emd_nm as EMD_NM,
                       JM.jm_ri_nm as RI_NM,
                       JM.jm_jibun as JIBUN,
                       JM.jm_pnu as PNU,
                       RPAD(JM.jm_ADDRCODE, 10, '0') AS ADDRCODE,
                       JM.jm_jasan_no as JASAN_NO,
                       TO_CHAR(JM.jm_CHUIDEUK_DATE, 'YYYY-MM-DD') AS CHUIDEUK_DATE,
                       JM.jm_chuideuk_money as CHUIDEUK_MONEY,
                       JM.jm_jasan_money as JASAN_MONEY,
                       NULL AS PMT_NO,
                       NULL AS PAY_MONEY,
                       NULL AS PAY_DATE,
                       NULL AS PMT_ST_DATE,
                       NULL AS PMT_ED_DATE,
                       NULL AS GOVER_LENGTH,
                       JM.jm_PYEONIB_AREA + COALESCE(
                         (SELECT SUM(S.jm_PYEONIB_AREA)
                            FROM JISANG_MERGE S
                           WHERE S.jm_REP_JISANG_NO = JM.jm_JISANG_NO), 0) AS GOVER_AREA,
                       NULL AS PIPE_METER,
                       NULL AS PIPE_METER2,
                       JS.SOUJA_NAME,
                       (
                         SELECT COUNT(js_JISANG_NO) - 1
                           FROM JISANG_SOUJA
                          WHERE js_JISANG_NO = JM.jm_JISANG_NO
                       ) AS SOUJA_CNT,
                       JM.jm_gover_own_yn as GOVER_OWN_YN,
                       JM.jm_jijuk_area as JIJUK_AREA,
                       JM.jm_comple_yn as COMPLE_YN,
                       JM.jm_permitted_yn as PERMITTED_YN
                  FROM JISANG_MASTER JM
                  LEFT JOIN (
                    SELECT js_jisang_no as JISANG_NO,
                           js_souja_name as SOUJA_NAME,
                           ROW_NUMBER() OVER (PARTITION BY js_JISANG_NO ORDER BY js_JISANG_NO ASC) AS ROW_IDX
                      FROM JISANG_SOUJA
                     GROUP BY js_JISANG_NO, js_SOUJA_NAME
                  ) JS ON JM.jm_JISANG_NO = JS.JISANG_NO
                 WHERE (JM.jm_CANCLE_YN IS NULL OR JM.jm_CANCLE_YN != 'Y')

                UNION ALL

                SELECT GP.gp_GOVER_NO AS MASTER_NO,
                       'GOVER' AS JISANG_STATUS,
                       (
                         SELECT S.gm_jisa as JISA
                           FROM GOVER_MASTER S
                          WHERE S.gm_GOVER_NO = GP.gp_GOVER_NO
                       ) AS JISA,
                       GP.gp_sido_nm as SIDO_NM,
                       GP.gp_sgg_nm as SGG_NM,
                       GP.gp_emd_nm as EMD_NM,
                       GP.gp_ri_nm as RI_NM,
                       GP.gp_jibun as JIBUN,
                       GP.gp_pnu as PNU,
                       GP.gp_addrcode as ADDRCODE,
                       NULL AS JASAN_NO,
                       NULL AS CHUIDEUK_DATE,
                       NULL AS CHUIDEUK_MONEY,
                       NULL AS JASAN_MONEY,
                       GPE.PMT_NO,
                       GPE.PAY_MONEY,
                       TO_CHAR(GPE.PAY_DATE, 'YYYY-MM-DD') AS PAY_DATE,
                       TO_CHAR(GM.gm_GOVER_ST_DATE, 'YYYY-MM-DD') AS PMT_ST_DATE,
                       TO_CHAR(GM.gm_GOVER_ED_DATE, 'YYYY-MM-DD') AS PMT_ED_DATE,
                       GP.gp_gover_length as GOVER_LENGTH,
                       GP.gp_gover_area as GOVER_AREA,
                       (SELECT S.gm_PIPE_METER FROM GOVER_MASTER S WHERE S.gm_GOVER_NO = GP.gp_GOVER_NO) AS PIPE_METER,
                       (SELECT S.gm_PIPE_METER2 FROM GOVER_MASTER S WHERE S.gm_GOVER_NO = GP.gp_GOVER_NO) AS PIPE_METER2,
                       NULL AS SOUJA_NAME,
                       0 AS SOUJA_CNT,
                       GP.gp_gover_own_yn as GOVER_OWN_YN,
                       GP.gp_jijuk_area as JIJUK_AREA,
                       '' AS COMPLE_YN,
                       '' AS PERMITTED_YN
                  FROM GOVER_PNU GP
                  LEFT JOIN (
                    SELECT S.gp_gover_no as GOVER_NO,
                           S.gp_pay_money as PAY_MONEY,
                           S.gp_pay_vat as PAY_VAT,
                           S.gp_pay_date as PAY_DATE,
                           S.gp_pay_way as PAY_WAY,
                           S.gp_pmt_no as PMT_NO,
                           S.gp_pmt_st_date as PMT_ST_DATE,
                           S.gp_pmt_ed_date as PMT_ED_DATE
                      FROM GOVER_PERMIT S
                      INNER JOIN (
                        SELECT MAX(SS.gp_SEQ) AS SEQ, SS.gp_gover_no as GOVER_NO
                          FROM GOVER_PERMIT SS
                         WHERE SS.gp_PMT_NO IS NOT NULL
                           AND SS.gp_DOCKEY IN (
                             SELECT SSS.pa_dockey as DOCKEY
                               FROM PLMS_APPROVAL SSS
                              WHERE SSS.pa_STATUS IS NOT NULL
                                AND SSS.pa_STATUS != 'X'
                           )
                         GROUP BY SS.gp_GOVER_NO
                      ) SS ON S.gp_SEQ = SS.SEQ AND S.gp_GOVER_NO = SS.GOVER_NO
                  ) GPE ON GP.gp_GOVER_NO = GPE.GOVER_NO
                  LEFT JOIN GOVER_MASTER GM ON GP.gp_GOVER_NO = GM.gm_GOVER_NO
                 WHERE GM.gm_SAVE_STATUS = 'A'
                   AND GM.gm_CANCLE_YN IS NULL

                UNION ALL

                SELECT NM.nm_NOTSET_NO AS MASTER_NO,
                       'NOTSET' AS JISANG_STATUS,
                       NM.nm_jisa as JISA,
                       NM.nm_sido_nm as SIDO_NM,
                       NM.nm_sgg_nm as SGG_NM,
                       NM.nm_emd_nm as EMD_NM,
                       NM.nm_ri_nm as RI_NM,
                       NM.nm_jibun as JIBUN,
                       NM.nm_pnu as PNU,
                       NM.nm_addrcode as ADDRCODE,
                       NULL AS JASAN_NO,
                       NULL AS CHUIDEUK_DATE,
                       NULL AS CHUIDEUK_MONEY,
                       NULL AS JASAN_MONEY,
                       NULL AS PMT_NO,
                       NULL AS PAY_MONEY,
                       NULL AS PAY_DATE,
                       NULL AS PMT_ST_DATE,
                       NULL AS PMT_ED_DATE,
                       NULL AS GOVER_LENGTH,
                       NULL AS GOVER_AREA,
                       NULL AS PIPE_METER,
                       NULL AS PIPE_METER2,
                       NS.SOUJA_NAME,
                       (
                         SELECT COUNT(ns_NOTSET_NO) - 1
                           FROM NOTSET_SOUJA
                          WHERE ns_NOTSET_NO = NM.nm_NOTSET_NO
                       ) AS SOUJA_CNT,
                       NM.nm_gover_own_yn as GOVER_OWN_YN,
                       NM.nm_jijuk_area as JIJUK_AREA,
                       '' AS COMPLE_YN,
                       '' AS PERMITTED_YN
                  FROM NOTSET_MASTER NM
                  LEFT JOIN (
                    SELECT ns_notset_no as NOTSET_NO,
                           ns_souja_name as SOUJA_NAME,
                           ROW_NUMBER() OVER (PARTITION BY ns_NOTSET_NO ORDER BY ns_NOTSET_NO ASC) AS ROW_IDX
                      FROM NOTSET_SOUJA
                     GROUP BY ns_NOTSET_NO, ns_SOUJA_NAME
                  ) NS ON NM.nm_NOTSET_NO = NS.NOTSET_NO
                 WHERE NM.nm_DEL_FLAG = 'N'

                UNION ALL

                SELECT DM.dom_DOPCO_NO AS MASTER_NO,
                       'DOPCO' AS JISANG_STATUS,
                       DM.dom_jisa as JISA,
                       DM.dom_sido_nm as SIDO_NM,
                       DM.dom_sgg_nm as SGG_NM,
                       DM.dom_emd_nm as EMD_NM,
                       DM.dom_ri_nm as RI_NM,
                       DM.dom_jibun as JIBUN,
                       DM.dom_pnu as PNU,
                       DM.dom_addrcode as ADDRCODE,
                       DM.dom_jasan_no as JASAN_NO,
                       TO_CHAR(DM.dom_DEUNGGI_DATE, 'YYYY-MM-DD') AS CHUIDEUK_DATE,
                       NULL AS CHUIDEUK_MONEY,
                       DM.dom_JASAN_MONEY::numeric AS JASAN_MONEY,
                       NULL AS PMT_NO,
                       NULL AS PAY_MONEY,
                       NULL AS PAY_DATE,
                       NULL AS PMT_ST_DATE,
                       NULL AS PMT_ED_DATE,
                       NULL AS GOVER_LENGTH,
                       NULL AS GOVER_AREA,
                       NULL AS PIPE_METER,
                       NULL AS PIPE_METER2,
                       DM.dom_souja_name as SOUJA_NAME,
                       0 AS SOUJA_CNT,
                       DM.dom_gover_own_yn as GOVER_OWN_YN,
                       DM.dom_jijuk_area as JIJUK_AREA,
                       '' AS COMPLE_YN,
                       '' AS PERMITTED_YN
                  FROM DOPCO_MASTER DM
                 WHERE DM.dom_CANCLE_YN IS NULL
              ) JOIN_MST ON JOIN_MST.PNU = JIJUK_MST.PNU
				 <if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(SEARCH_JISA)" > 
		   		AND JOIN_MST.JISA = #{SEARCH_JISA}
		    </if>
              LEFT JOIN (
                SELECT S.*
                  FROM (
                    SELECT RANK() OVER (PARTITION BY RPAD(PPI.addrcode, 10, '0'), PPI.JIBUN ORDER BY PPI.ISSUE_DATE DESC) AS RANK,
                           RPAD(PPI.addrcode, 10, '0') AS ADDRCODE,
                           PPI.jibun as JIBUN,
                           PPI.code_depth1 as CODE_DEPTH1,
                           PPI.code_depth2 as CODE_DEPTH2,
                           PPI.code_depth3 as CODE_DEPTH3,
                           PPI.registed_yn as REGISTED_YN,
                           PPI.permitted_yn as PERMITTED_YN,
                           PPI.pnu as PNU,
                           PPI.del_flag as DEL_FLAG
                      FROM plms_POTENTIAL_ISSUE PPI
                     WHERE PPI.DEL_FLAG != 'Y'
                  ) S WHERE S.RANK = 1
              ) PPI ON RPAD(JOIN_MST.ADDRCODE, 10, '0') = PPI.ADDRCODE
              
                AND JOIN_MST.JIBUN = PPI.JIBUN
                
              LEFT JOIN GOVER_POTENTIAL_ISSUE GPI ON JOIN_MST.MASTER_NO = GPI.GOVER_NO
                AND GPI.DEL_FLAG != 'Y'
               
          ) T
          LEFT JOIN (
            SELECT SUBSTRING(A.CODE, 1, 4) || '0000' AS DEPTH1,
                   SUBSTRING(A.CODE, 1, 6) || '00' AS DEPTH2,
                   A.CODE AS DEPTH3,
                   A.CODE_NAME AS DEPTH3_NAME,
                   A.REGISTED_YN,
                   A.PERMITTED_YN
              FROM PLMS_ISSUE_CODE A
             WHERE A.CODE_DEPTH = 3

            UNION ALL

            SELECT 'NONE', 'NONE', 'NONE', NULL, NULL, NULL
             
          ) TN ON TN.DEPTH1 = T.CODE_DEPTH1
          LEFT JOIN PLMS_ISSUE_CODE PIC1 ON TN.DEPTH1 = PIC1.CODE
          LEFT JOIN PLMS_ISSUE_CODE PIC2 ON TN.DEPTH2 = PIC2.CODE
          <if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(SEARCH_CODE_1)" > 
   AND TN.DEPTH1 = #{SEARCH_CODE_1}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(SEARCH_CODE_2)" > 
   AND TN.DEPTH2 = #{SEARCH_CODE_2}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(SEARCH_CODE_3)" > 
   AND TN.DEPTH3 = #{SEARCH_CODE_3}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(SEARCH_REGISTED)" > 
   AND SUBSTR(TN.DEPTH3, 1, 2) = #{SEARCH_REGISTED}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(SEARCH_PERMITTED)" > 
   AND TN.PERMITTED_YN = #{SEARCH_PERMITTED}
		</if>
         GROUP BY TN.DEPTH1,
                  TN.DEPTH2,
                  TN.DEPTH3,
                  TN.REGISTED_YN,
                  TN.PERMITTED_YN,
                  PIC1.CODE_NAME,
                  PIC2.CODE_NAME,
                  TN.DEPTH3_NAME
         ORDER BY SUBSTRING(TN.DEPTH3, 1, 1) ASC,
                  TN.REGISTED_YN DESC,
                  TN.DEPTH3 ASC
    ) TT
) TTT

	</select>
	
	<!-- 통계 > 권리별 증감현황 > 지사 -->
	<select id="selectByRightInDeListJisa" parameterType="HashMap" resultType="HashMap">
		select desc1 from static_deadline_info group by desc1,desc1_num order by desc1_num
	</select>
	
	<!-- 통계 > 권리별 증감현황 > 권리확보 -->
	<select id="selectByRightInDeListByRight" parameterType="HashMap" resultType="HashMap">
		select jisang_status from static_deadline_info where jisang_status <![CDATA[<>]]> 'ALL' group by jisang_status,status_num order by status_num
	</select>
	
	<!-- 통계 > 권리별 증감현황 > 년 -->
	<select id="selectByRightInDeListYYYY" parameterType="HashMap" resultType="HashMap">
		select year from static_deadline where desc1 is not null 
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(JISA)" > 
			and desc1='#{JISA}' 
		</if>
		
		group by year order by year
	</select>
	
	<!-- 통계 > 권리별 증감현황 > 년,월 -->
	<select id="selectByRightInDeListYYYYMM" parameterType="HashMap" resultType="HashMap">
		select month from static_deadline where desc1 is not null 
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(JISA)" > 
			and desc1=#{JISA} 
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(SELECT_YYYY)" > 
			and year = #{SELECT_YYYY} 
		</if>
		group by month order by month
	</select>
	
	<!-- 통계 > 권리별 증감현황 > 조회 -->
	<select id="selectByRightInDeList" parameterType="HashMap" resultType="HashMap">
		with
			all_tb as (
				select * 
				from static_deadline_info 
				where
					1=1
					<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(JISA)" > 
						and desc1 = #{JISA} 
					</if>
					<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(STATUS)" > 
						and jisang_status = #{STATUS} 
					</if>
					),
			ref_tb as (select * from static_deadline where YEAR = #{YYYY_REF} and month = #{MM_REF} and desc1 is not null),
			tg_tb as (select * from static_deadline where year = #{YYYY_TG} and month = #{MM_TG}  and desc1 is not null),
			add_cnt as (
				select 
					a.desc1,a.jisang_status, 'NEW' as gubun, count(*) as cnt 
				from 
					ref_tb a
				left join
					tg_tb b
				on
					a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
				where 
					b.juso is null
				group by
					a.desc1,a.jisang_status
				union all
				select 
					a.desc1,'ALL', 'NEW' as gubun, count(*) as cnt 
				from 
					ref_tb a
				left join
					tg_tb b
				on
					a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
				where 
					b.juso is null
				group by
					a.desc1
				),
			rm_cnt as (
				select 
					a.desc1,a.jisang_status, 'DEL' as gubun, count(*) as cnt
				from 
					tg_tb a
				left join
					ref_tb b
				on
					a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
				where 
					b.juso is null
				group by
					a.desc1,a.jisang_status
				union all 
				select 
					a.desc1,'ALL', 'NEW' as gubun, count(*) as cnt 
				from 
					tg_tb a
				left join
					ref_tb b
				on
					a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
				where 
					b.juso is null
				group by
					a.desc1
			)
			,
			ref_stat as (
				select desc1,jisang_status,count(*) as cnt from ref_tb group by desc1,jisang_status
				union all 
				select desc1,'ALL' as jisang_status,count(*) from ref_tb group by desc1
				),
			tg_stat as (
				select desc1,jisang_status,count(*) as cnt from tg_tb group by desc1,jisang_status
				union all 
				select desc1,'ALL' as jisang_status,count(*) from tg_tb group by desc1
				)
			select 
				a.desc1,a.jisang_status, coalesce(b.cnt,0) as ref_cnt , coalesce(c.cnt,0) as tg_cnt,coalesce(d.cnt,0) add_cnt,coalesce(e.cnt,0) as del_cnt
			from 
				all_tb a
			left join
				ref_stat b
			on
				a.desc1= b.desc1 and a.jisang_status = b.jisang_status
			left join 
				tg_stat c
			on
				a.desc1= c.desc1 and a.jisang_status = c.jisang_status
			left join 
				add_cnt d
			on
				a.desc1= d.desc1 and a.jisang_status = d.jisang_status
			left join 
				rm_cnt e
			on
				a.desc1= e.desc1 and a.jisang_status = e.jisang_status
			order by 
				a.desc1_num, a.status_num
	</select>
	
	<!-- 통계 > 권리별 증감현황 > 조회 상세 -->
	<select id="selectByRightInDeListDetail" parameterType="HashMap" resultType="HashMap">
		select
			desc1,
			juso,
			jisang_status
		from 
			static_deadline 
		where 
			1=1
			and year= #{YYYY}
			and month = #{MM}
			and desc1 = #{JISA}
			and jisang_status = #{STATUS}
	</select>
	
	<!-- 통계 > 권리별 증감현황 > 조회 상세 > 증감현황 > 증가 -->
	<select id="selectByRightInDeListDetailUp" parameterType="HashMap" resultType="HashMap">
		select 
			a.desc1,a.juso, a.jisang_status
		from 
			(select * from static_deadline where year = #{YYYY_REF} and month = #{MM_REF} and desc1 is not null) a
		left join
			(select * from static_deadline where year = #{YYYY_TG} and month = #{MM_TG} and desc1 is not null) b
		on
			a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
		where 
			1=1
			and a.desc1 = #{JISA}
			and a.jisang_status = #{STATUS}
			and b.juso is null
	</select>
	
	<!-- 통계 > 권리별 증감현황 > 조회 상세 > 증감현황 > 감소 -->
	<select id="selectByRightInDeListDetailDown" parameterType="HashMap" resultType="HashMap">
		select 
			a.desc1,a.juso, a.jisang_status
		from 
			(select * from static_deadline where year = #{YYYY_REF} and month = #{MM_REF} and desc1 is not null) a
		left join
			(select * from static_deadline where year = #{YYYY_TG} and month = #{MM_TG} and desc1 is not null) b
		on
			a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
		where 
			1=1
			and a.desc1 = #{JISA}
			and a.jisang_status = #{STATUS}
			and b.juso is null
	</select>
	
		
	<!-- 통계 > 관리필지 증감현황 > 년,월 -->
	<select id="selectFieldInDeListYYYY" parameterType="HashMap" resultType="HashMap">
		select year from static_deadline where desc1 is not null group by year order by year
	</select>
	
	<!-- 통계 > 관리필지 증감현황 > 년,월 -->
	<select id="selectFieldInDeListYYYYMM" parameterType="HashMap" resultType="HashMap">
		select month from static_deadline 
		where desc1 is not null 
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(SELECT_YYYY)" > 
			and year = #{SELECT_YYYY} 
		</if>
		group by month order by month
	</select>
	
	<!-- 통계 > 관리필지 증감현황 > 조회 -->
	<select id="selectFieldInDeList" parameterType="HashMap" resultType="HashMap">
		with
			all_tb as (
				select desc1,desc1_num 
				from static_deadline_info group by desc1,desc1_num
					),
			ref_tb as (select * from static_deadline where jisang_status = '지상권' and  jisang_manage='N' and year = #{YYYY_REF} and month = #{MM_REF} and desc1 is not null), --기준년월
			tg_tb as (select * from static_deadline where jisang_status = '지상권' and  jisang_manage='N' and year = #{YYYY_TG} and month = #{MM_TG} and desc1 is not null), --비교년월
			ref_stat_cmpY as (
				select desc1,count(*) from ref_tb where comple_yn = 'Y' group by desc1
				), --기준 등기
			ref_stat_cmpN_pmtY as (
				select desc1,count(*) from ref_tb where comple_yn <![CDATA[<>]]> 'Y' and permitted_yn <![CDATA[<>]]> '없음' group by desc1
				), --기준 미등기/계약
			ref_stat_cmpN_pmtN as (
				select desc1,count(*) from ref_tb where comple_yn <![CDATA[<>]]> 'Y' and permitted_yn = '없음' group by desc1
				), --기준 미등기/미계약
			ref_stat_cmpN as (
				select desc1,count(*) from ref_tb where comple_yn <![CDATA[<>]]> 'Y' group by desc1
				), --기준 미등기/소계
			ref_stat as (
				select desc1,count(*) from ref_tb group by desc1
				), --기준 전체
			tg_stat_cmpY as (
				select desc1,count(*) from tg_tb where comple_yn = 'Y' group by desc1
				), --비교 등기
			tg_stat_cmpN_pmtY as (
				select desc1,count(*) from tg_tb where comple_yn <![CDATA[<>]]> 'Y' and permitted_yn <![CDATA[<>]]> '없음' group by desc1
				), --비교 미등기/계약
			tg_stat_cmpN_pmtN as (
				select desc1,count(*) from tg_tb where comple_yn <![CDATA[<>]]> 'Y' and permitted_yn = '없음' group by desc1
				), --비교 미등기/미계약
			tg_stat_cmpN as (
				select desc1,count(*) from tg_tb where comple_yn <![CDATA[<>]]> 'Y' group by desc1
				), --비교 미등기/소계
			tg_stat as (
				select desc1,count(*) from tg_tb group by desc1
				), --비교 전체
			fin as (select
				a.desc1, --지사구분
				coalesce(b.count,'0') as ref_cmpY, --기준 등기
				coalesce(c.count,'0') as ref_cmpN_pmtY, --기준 미등기 계약
				coalesce(d.count,'0') as ref_cmpN_pmtN, --기준 미등기 미계약
				coalesce(e.count,'0') as ref_cmpN, --기준 미등기 소계
				coalesce(f.count,'0') as ref_sum, --기준 전체
				coalesce(g.count,'0') as tg_cmpY, --비교 등기
				coalesce(h.count,'0') as tg_cmpN_pmtY, --비교 미등기 계약
				coalesce(i.count,'0') as tg_cmpN_pmtN, --비교 미등기 미계약
				coalesce(j.count,'0') as tg_cmpN, --비교 미등기 소계
				coalesce(k.count,'0') as tg_sum --비교 전체
			from  
				all_tb a
			left join 
				ref_stat_cmpY b
			on
				a.desc1 = b.desc1
			left join 
				ref_stat_cmpN_pmtY c
			on
				a.desc1 = c.desc1
			left join 
				ref_stat_cmpN_pmtN d
			on
				a.desc1 = d.desc1
			left join 
				ref_stat_cmpN e
			on
				a.desc1 = e.desc1
			left join 
				ref_stat f
			on
				a.desc1 = f.desc1
			left join 
				tg_stat_cmpY g
			on
				a.desc1 = g.desc1
			left join 
				tg_stat_cmpN_pmtY h
			on
				a.desc1 = h.desc1
			left join 
				tg_stat_cmpN_pmtN i
			on
				a.desc1 = i.desc1
			left join 
				tg_stat_cmpN j
			on
				a.desc1 = j.desc1
			left join 
				tg_stat k
			on
				a.desc1 = k.desc1
			order by a.desc1_num)
		select
			*,
			(ref_cmpy - tg_cmpy) as cmpy_dif, --증감 등기
			(ref_cmpn_pmty - tg_cmpn_pmty) as cmpn_pmty_dif, --증감 미등기 계약
			(ref_cmpn_pmtn - tg_cmpn_pmtn) as cmpn_pmtn_dif, --증감 미등기 미계약
			(ref_cmpn - tg_cmpn) as cmpn_dif, --증감 미등기 소계
			(ref_sum - tg_sum) as sum_dif --증감 전체
		from fin
	</select>
	
	<!-- 통계 > 관리필지 증감현황 > 메인 조회 > 등기 -->
	<select id="selectFieldInDeListDetailRegistered" parameterType="HashMap" resultType="HashMap">
		select
			desc1,
			juso,
			jisang_status
		from 
			static_deadline 
		where 
			1=1
			and year = #{YYYY}
			and month = #{MM} 
			and desc1 = #{JISA}
			and jisang_status = '지상권'
			and comple_yn = 'Y'
			and jisang_manage = 'N'
	</select>
	
	<!-- 통계 > 관리필지 증감현황 > 메인 조회 > 미등기/계약 -->
	<select id="selectFieldInDeListDetailUnRegisteredContract" parameterType="HashMap" resultType="HashMap">
		select
			desc1,
			juso,
			jisang_status
		from 
			static_deadline 
		where 
			1=1
			and year = #{YYYY}
			and month = #{MM} 
			and desc1 = #{JISA}
			and jisang_status = '지상권'
			and comple_yn <![CDATA[<>]]> 'Y'
			and permitted_yn <![CDATA[<>]]> '없음'
			and jisang_manage = 'N'
	</select>
	
	<!-- 통계 > 관리필지 증감현황 > 메인 조회 > 미등기/미계약 -->
	<select id="selectFieldInDeListDetailUnRegisteredUnContract" parameterType="HashMap" resultType="HashMap">
		select
			desc1,
			juso,
			jisang_status
		from 
			static_deadline 
		where 
			1=1
			and year = #{YYYY}
			and month = #{MM} 
			and desc1 = #{JISA}
			and jisang_status = '지상권'
			and comple_yn <![CDATA[<>]]> 'Y'
			and permitted_yn = '없음'
			and jisang_manage = 'N'
	</select>
	
	<!-- 통계 > 관리필지 증감현황 > 메인 조회 > 미등기/소계 -->
	<select id="selectFieldInDeListDetailUnRegisteredSubtotal" parameterType="HashMap" resultType="HashMap">
		select
			desc1,
			juso,
			jisang_status
		from 
			static_deadline 
		where 
			1=1
			and year = #{YYYY}
			and month = #{MM} 
			and desc1 = #{JISA}
			and jisang_status = '지상권'
			and comple_yn <![CDATA[<>]]> 'Y'
			and jisang_manage = 'N'
	</select>
		
	<!-- 통계 > 관리필지 증감현황 > 메인 조회 > 전체 -->
	<select id="selectFieldInDeListDetailAll" parameterType="HashMap" resultType="HashMap">
		select
			desc1,
			juso,
			jisang_status
		from 
			static_deadline 
		where 
			1=1
			and year = #{YYYY}
			and month = #{MM} 
			and desc1 = #{JISA}
			and jisang_status = '지상권'
			and jisang_manage = 'N'
	</select>	
	
	<!-- 통계 > 관리필지 증감현황 > 현황상세정보 메인 조회 > 전체 -->
	<select id="selectFieldInDeStatusBoardList" parameterType="HashMap" resultType="HashMap">
		with
			all_tb as (
					select desc1,desc1_num from static_deadline_info group by desc1,desc1_num
							union all
							select concat(desc1,'-분기') as desc1, desc1_num+0.1 as desc1_num from static_deadline_info group by desc1,desc1_num
						),
				ref_tb as (select * from static_deadline where jisang_status <![CDATA[<>]]> '회사토지' and jisang_manage = 'N' and year = #{YYYY_REF} and month = #{MM_REF} and desc1 is not null), --기준년월
				tg_tb as (select * from static_deadline where jisang_status <![CDATA[<>]]> '회사토지' and jisang_manage = 'N' and year = #{YYYY_TG} and month = #{MM_TG} and desc1 is not null), --비교년월
				ref_priv_cmpy as ( --기준 사유지 지상권(등기)
					select desc1,count(*) from ref_tb where gover_own_yn = '사유지' and jisang_status = '지상권' and comple_yn = 'Y' group by desc1
					union all
					select 
						concat(a.desc1,'-분기') as desc1, count(*)
					from 
						ref_tb a
					left join
						tg_tb b
					on
						a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
					where
						b.juso is null and a.gover_own_yn = '사유지' and a.jisang_status = '지상권' and a.comple_yn = 'Y'
					group by a.desc1
					),
				ref_priv_cmpn as ( --기준 사유지 미등기
					select desc1,count(*) from ref_tb where gover_own_yn = '사유지' and jisang_status = '지상권' and comple_yn <![CDATA[<>]]> 'Y' group by desc1
					union all
					select 
						concat(a.desc1,'-분기') as desc1, count(*)
					from 
						ref_tb a
					left join
						tg_tb b
					on
						a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
					where
						b.juso is null and a.gover_own_yn = '사유지' and a.jisang_status = '지상권' and a.comple_yn <![CDATA[<>]]> 'Y'
					group by a.desc1
					),
				ref_priv_ntst as ( --기준 사유지 미설정
					select desc1,count(*) from ref_tb where gover_own_yn = '사유지' and jisang_status = '미설정' group by desc1
					union all
					select 
						concat(a.desc1,'-분기') as desc1, count(*)
					from 
						ref_tb a
					left join
						tg_tb b
					on
						a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
					where
						b.juso is null and a.gover_own_yn = '사유지' and a.jisang_status = '미설정'
					group by a.desc1
					),
				ref_priv_sum as ( --기준 사유지 계
					select desc1,count(*) from ref_tb where gover_own_yn = '사유지' and jisang_status <![CDATA[<>]]> '점용' group by desc1
					union all
					select 
						concat(a.desc1,'-분기') as desc1, count(*)
					from 
						ref_tb a
					left join
						tg_tb b
					on
						a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
					where
						b.juso is null and a.gover_own_yn = '사유지' and a.jisang_status <![CDATA[<>]]> '점용'
					group by a.desc1
					),
				ref_gover_jisang as ( --기준 국유지 지상권
					select desc1,count(*) from ref_tb where gover_own_yn = '국유지' and jisang_status = '지상권' group by desc1
					union all
					select 
						concat(a.desc1,'-분기') as desc1, count(*)
					from 
						ref_tb a
					left join
						tg_tb b
					on
						a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
					where
						b.juso is null and a.gover_own_yn = '국유지' and a.jisang_status = '지상권'
					group by a.desc1
					),
				ref_gover_g as ( --기준 국유지 점용
					select desc1,count(*) from ref_tb where gover_own_yn = '국유지' and jisang_status = '점용' group by desc1
					union all 
					select 
						concat(a.desc1,'-분기') as desc1, count(*)
					from 
						ref_tb a
					left join
						tg_tb b
					on
						a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
					where
						b.juso is null and a.gover_own_yn = '국유지' and a.jisang_status = '점용'
					group by a.desc1
					),
				ref_gover_ntst as ( --기준 국유지 미설정
					select desc1,count(*) from ref_tb where gover_own_yn = '국유지' and jisang_status = '미설정' group by desc1
					union all
					select 
						concat(a.desc1,'-분기') as desc1, count(*)
					from 
						ref_tb a
					left join
						tg_tb b
					on
						a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
					where
						b.juso is null and a.gover_own_yn = '국유지' and a.jisang_status = '미설정'
					group by a.desc1
					),
				ref_gover_sum as ( --기준 국유지 계
					select desc1,count(*) from ref_tb where gover_own_yn = '국유지' group by desc1
					union all
					select 
						concat(a.desc1,'-분기') as desc1, count(*)
					from 
						ref_tb a
					left join
						tg_tb b
					on
						a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
					where
						b.juso is null and a.gover_own_yn = '국유지'
					group by a.desc1
					),
				ref_sum as ( --기준 합계
					select desc1,count(*) from ref_tb where not(gover_own_yn = '사유지' and jisang_status = '점용') group by desc1
					union all 
					select 
						concat(a.desc1,'-분기') as desc1, count(*)
					from 
						ref_tb a
					left join
						tg_tb b
					on
						a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
					where
						b.juso is null and not(a.gover_own_yn = '사유지' and a.jisang_status = '점용')
					group by a.desc1
					),
				tg_priv_cmpy as ( --비교 사유지 지상권(등기)
					select desc1,count(*) from tg_tb where gover_own_yn = '사유지' and jisang_status = '지상권' and comple_yn = 'Y' group by desc1
					union all
					select 
						concat(a.desc1,'-분기'), count(*)
					from 
						tg_tb a
					left join
						ref_tb b
					on
						a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
					where
						b.juso is null and a.gover_own_yn = '사유지' and a.jisang_status = '지상권' and a.comple_yn = 'Y'
					group by a.desc1
					),
				tg_priv_cmpn as ( --비교 사유지 미등기
					select desc1,count(*) from tg_tb where gover_own_yn = '사유지' and jisang_status = '지상권' and comple_yn <![CDATA[<>]]> 'Y' group by desc1
					union all
					select 
						concat(a.desc1,'-분기'), count(*)
					from 
						tg_tb a
					left join
						ref_tb b
					on
						a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
					where
						b.juso is null and a.gover_own_yn = '사유지' and a.jisang_status = '지상권' and a.comple_yn <![CDATA[<>]]> 'Y'
					group by a.desc1
					),
				tg_priv_ntst as ( --비교 사유지 미설정
					select desc1,count(*) from tg_tb where gover_own_yn = '사유지' and jisang_status = '미설정' group by desc1
					union all
					select 
						concat(a.desc1,'-분기'), count(*)
					from 
						tg_tb a
					left join
						ref_tb b
					on
						a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
					where
						b.juso is null and a.gover_own_yn = '사유지' and a.jisang_status = '미설정'
					group by a.desc1
					),
				tg_priv_sum as ( --비교 사유지 계
					select desc1,count(*) from tg_tb where gover_own_yn = '사유지' and jisang_status <![CDATA[<>]]> '점용' group by desc1
					union all
					select 
						concat(a.desc1,'-분기'), count(*)
					from 
						tg_tb a
					left join
						ref_tb b
					on
						a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
					where
						b.juso is null and a.gover_own_yn = '사유지' and a.jisang_status <![CDATA[<>]]> '점용'
					group by a.desc1
					),
				tg_gover_jisang as ( --비교 국유지 지상권
					select desc1,count(*) from tg_tb where gover_own_yn = '국유지' and jisang_status = '지상권' group by desc1
					union all
					select 
						concat(a.desc1,'-분기'), count(*)
					from 
						tg_tb a
					left join
						ref_tb b
					on
						a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
					where
						b.juso is null and a.gover_own_yn = '국유지' and a.jisang_status = '지상권'
					group by a.desc1
					),	
				tg_gover_g as ( --비교 국유지 점용
					select desc1,count(*) from tg_tb where gover_own_yn = '국유지' and jisang_status = '점용' group by desc1
					union all
					select 
						concat(a.desc1,'-분기'), count(*)
					from 
						tg_tb a
					left join
						ref_tb b
					on
						a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
					where
						b.juso is null and a.gover_own_yn = '국유지' and a.jisang_status = '점용'
					group by a.desc1
					),
				tg_gover_ntst as ( --비교 국유지 점용
					select desc1,count(*) from tg_tb where gover_own_yn = '국유지' and jisang_status = '미설정' group by desc1
					union all 
					select 
						concat(a.desc1,'-분기'), count(*)
					from 
						tg_tb a
					left join
						ref_tb b
					on
						a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
					where
						b.juso is null and a.gover_own_yn = '국유지' and a.jisang_status = '미설정'
					group by a.desc1
					),
				tg_gover_sum as ( --비교 국유지 계
					select desc1,count(*) from tg_tb where gover_own_yn = '국유지' group by desc1
					union all 
					select 
						concat(a.desc1,'-분기'), count(*)
					from 
						tg_tb a
					left join
						ref_tb b
					on
						a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
					where
						b.juso is null and a.gover_own_yn = '국유지'
					group by a.desc1
					),
				tg_sum as ( --비교 합계
					select desc1,count(*) from tg_tb where not(gover_own_yn = '사유지' and jisang_status = '점용') group by desc1
					union all
					select 
						concat(a.desc1,'-분기'), count(*)
					from 
						tg_tb a
					left join
						ref_tb b
					on
						a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
					where
						b.juso is null and not(a.gover_own_yn = '사유지' and a.jisang_status = '점용')
					group by a.desc1
					),
				fin as (select
					t1.desc1,
					coalesce(t2.count,0) as ref_priv_cmpy_cont, --기준 사유지 지상권
					coalesce(t3.count,0) as ref_priv_cmpn_cont, --기준 사유지 미등기
					coalesce(t4.count,0) as ref_priv_ntst_cont, --기준 사유지 미설정
					coalesce(t5.count,0) as ref_priv_sum_cont, --기준 사유지 계
					coalesce(t6.count,0) as ref_gover_jisang_cont, --기준 국유지 지상권
					coalesce(t7.count,0) as ref_gover_g_cont, --기준 국유지 점용
					coalesce(t8.count,0) as ref_gover_ntst_cont, --기준 국유지 미설정
					coalesce(t9.count,0) as ref_gover_sum_cont, --기준 국유지 계
					coalesce(t10.count,0) as ref_sum_cont, --기준 합계
					coalesce(t11.count,0) as tg_priv_cmpy_cont, --비교 사유지 지상권
					coalesce(t12.count,0) as tg_priv_cmpn_cont, --비교 사유지 미등기
					coalesce(t13.count,0) as tg_priv_ntst_cont, --비교 사유지 미설정
					coalesce(t14.count,0) as tg_priv_sum_cont, --비교 사유지 계
					coalesce(t15.count,0) as tg_gover_jisang_cont, --비교 국유지 지상권
					coalesce(t16.count,0) as tg_gover_g_cont, --비교 국유지 점용
					coalesce(t17.count,0) as tg_gover_ntst_cont, --비교 국유지 미설정
					coalesce(t18.count,0) as tg_gover_sum_cont, --비교 국유지 계
					coalesce(t19.count,0) as tg_sum_cont --비교 합계
				from
					all_tb t1
				left join ref_priv_cmpy t2 on t1.desc1 =  t2.desc1
				left join ref_priv_cmpn t3 on t1.desc1 =  t3.desc1
				left join ref_priv_ntst t4 on t1.desc1 =  t4.desc1
				left join ref_priv_sum t5 on t1.desc1 =  t5.desc1
				left join ref_gover_jisang t6 on t1.desc1 =  t6.desc1
				left join ref_gover_g t7 on t1.desc1 =  t7.desc1
				left join ref_gover_ntst t8 on t1.desc1 =  t8.desc1
				left join ref_gover_sum t9 on t1.desc1 =  t9.desc1
				left join ref_sum t10 on t1.desc1 =  t10.desc1
				left join tg_priv_cmpy t11 on t1.desc1 =  t11.desc1
				left join tg_priv_cmpn t12 on t1.desc1 =  t12.desc1
				left join tg_priv_ntst t13 on t1.desc1 =  t13.desc1
				left join tg_priv_sum t14 on t1.desc1 =  t14.desc1
				left join tg_gover_jisang t15 on t1.desc1 =  t15.desc1
				left join tg_gover_g t16 on t1.desc1 =  t16.desc1
				left join tg_gover_ntst t17 on t1.desc1 =  t17.desc1
				left join tg_gover_sum t18 on t1.desc1 =  t18.desc1
				left join tg_sum t19 on t1.desc1 =  t19.desc1
				order by t1.desc1_num
				)
			select
				*,
				(ref_priv_cmpy_cont - tg_priv_cmpy_cont) as priv_cmpy_dif, --증감 사유지 지상권
				(ref_priv_cmpn_cont - tg_priv_cmpn_cont) as priv_cmpn_dif, --증감 사유지 미등기
				(ref_priv_ntst_cont - tg_priv_ntst_cont) as priv_ntst_dif, --증감 사유지 미설정
				(ref_priv_sum_cont - tg_priv_sum_cont) as priv_sum_dif, --증감 사유지 계
				(ref_gover_jisang_cont - tg_gover_jisang_cont) as gover_jisang_dif, --증감 국유지 지상권
				(ref_gover_g_cont - tg_gover_g_cont) as gover_g_dif, --증감 국유지 점용
				(ref_gover_ntst_cont - tg_gover_ntst_cont) as gover_ntst_dif, --증감 국유지 미설정
				(ref_gover_sum_cont - tg_gover_sum_cont) as gover_sum_dif, --증감 국유지 계
				(ref_sum_cont - tg_sum_cont) as sum_dif --증감 합계
			from
				fin
	</select>	
		
	
	
	<!-- 통계 > 관리필지 증감현황 > 현황상세정보 메인 조회 > (기준년월, 비교년월) 필지수 - 사유지 지상권 클릭 했을 때 -->
	<select id="selectFieldInDeStatusBoardListPrivateRegistered" parameterType="HashMap" resultType="HashMap">
		select
			desc1, juso, jisang_status
		from 
			static_deadline 
		where 
			1=1
			and year = #{YYYY}
			and month = #{MM}
			and desc1 = #{JISA}
			and gover_own_yn = '사유지'
			and jisang_status = '지상권'
			and comple_yn = 'Y'
			and jisang_manage = 'N'
	</select>
	
	
	
	
	<!-- 통계 > 관리필지 증감현황 > 현황상세정보 메인 조회 > (기준년월, 비교년월) 필지수 - 사유지 미등기 클릭 했을 때 -->
	<select id="selectFieldInDeStatusBoardListFieldPrivateUnRegistered" parameterType="HashMap" resultType="HashMap">
		select
			desc1, juso, jisang_status
		from 
			static_deadline 
		where 
			1=1
			and year = #{YYYY}
			and month = #{MM}
			and desc1 = #{JISA}
			and gover_own_yn = '사유지'
			and jisang_status = '지상권'
			and comple_yn <![CDATA[<>]]> 'Y'
			and jisang_manage = 'N';
	</select>
	
	
	<!-- 통계 > 관리필지 증감현황 > 현황상세정보 메인 조회 > (기준년월, 비교년월) 필지수 - 사유지 미설정 클릭 했을 때 -->
	<select id="selectFieldInDeStatusBoardListPrivateUnSetting" parameterType="HashMap" resultType="HashMap">
		select
			desc1, juso, jisang_status
		from 
			static_deadline 
		where 
			1=1
			and year = #{YYYY}
			and month = #{MM}
			and desc1 = #{JISA}
			and gover_own_yn = '사유지'
			and jisang_status = '미설정'
			and jisang_manage = 'N'
	</select>
	
	
	
	<!-- 통계 > 관리필지 증감현황 > 현황상세정보 메인 조회 > (기준년월, 비교년월) 필지수 - 사유지 계 클릭 했을 때 -->
	<select id="selectFieldInDeStatusBoardListPrivateProperty" parameterType="HashMap" resultType="HashMap">
		select
			desc1, juso, jisang_status
		from 
			static_deadline 
		where 
			1=1
			and year = #{YYYY}
			and month = #{MM}
			and desc1 = #{JISA}
			and gover_own_yn = '사유지' 
			and jisang_status not in ('점용','회사토지')
			and jisang_manage = 'N'
	</select>
	
	
	<!-- 통계 > 관리필지 증감현황 > 현황상세정보 메인 조회 > (기준년월, 비교년월) 필지수 - 국유지 지상권 클릭 했을 때 -->
	<select id="selectFieldInDeStatusBoardListPublicRegistered" parameterType="HashMap" resultType="HashMap">
		select
			desc1, juso, jisang_status
		from 
			static_deadline 
		where 
			1=1
			and year = #{YYYY}
			and month = #{MM}
			and desc1 = #{JISA}
			and gover_own_yn = '국유지'
			<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(JISANG_STATUS)" > 
				and jisang_status = #{JISANG_STATUS} //  지상권, 점용, 미설정, ""(제거시 전체)
			</if>
			
			and jisang_manage = 'N'
	</select>
	
	
	<!-- 통계 > 관리필지 증감현황 > 현황상세정보 메인 조회 > (기준년월, 비교년월) 필지수 - 합계 클릭 했을 때 -->
	<select id="selectFieldInDeStatusBoardListSum" parameterType="HashMap" resultType="HashMap">
		select
			desc1, juso, jisang_status
		from 
			static_deadline
		where 
			1 = 1
			and year = #{YYYY}
			and month = #{MM}
			and desc1 = #{JISA}
			and not(gover_own_yn = '사유지'
				and jisang_status = '점용')
			and jisang_manage = 'N';
	</select>
	
	
	
	<!-- 통계 > 관리필지 증감현황 > 현황상세정보 메인 조회 > 분기 - (기준년월, 비교년월) 분기 - 사유지 지상권 클릭 했을 때 -->
	<select id="selectFieldInDeStatusBoardListPrivateJisang" parameterType="HashMap" resultType="HashMap">
		select
			a.desc1, a.juso, a.jisang_status
		from 
			(select * from static_deadline where year = #{YYYY_REF} and month = #{MM_REF}) a
		left join
			(select * from static_deadline where year = #{YYYY_TG} and month = #{MM_TG}) b
		on
			a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
		where 
			1=1
			and b.juso is null
			and a.desc1 = #{JISA}
			and a.gover_own_yn = '사유지'
			and a.jisang_status = '지상권'
			and a.comple_yn = 'Y'
			and a.jisang_manage = 'N'
	</select>
	
	
	<!-- 통계 > 관리필지 증감현황 > 현황상세정보 메인 조회 > (기준년월, 비교년월) 분기 - 사유지 미등기 클릭 했을 때 -->
	<select id="selectFieldInDeStatusBoardListPrivateUnRegistered" parameterType="HashMap" resultType="HashMap">
		select
			a.desc1, a.juso, a.jisang_status
		from 
			(select * from static_deadline where year = #{YYYY_REF} and month = #{MM_REF}) a
		left join
			(select * from static_deadline where year = #{YYYY_TG} and month = #{MM_TG}) b
		on
			a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
		where 
			1=1
			and b.juso is null
			and a.desc1 = #{JISA}
			and a.gover_own_yn = '사유지'
			and a.jisang_status = '지상권'
			and a.comple_yn <![CDATA[<>]]> 'Y'
			and a.jisang_manage = 'N'
	</select>
	
	
	
	<!-- 통계 > 관리필지 증감현황 > 현황상세정보 메인 조회 > (기준년월, 비교년월) 분기 - 사유지 미설정 클릭 했을 때 -->
	<select id="selectFieldInDeStatusBoardListFieldPrivateUnSetting" parameterType="HashMap" resultType="HashMap">	
		select
			a.desc1, a.juso, a.jisang_status
		from 
			(select * from static_deadline where year = #{YYYY_REF} and month = #{MM_REF}) a
		left join
			(select * from static_deadline where year = #{YYYY_TG} and month = #{MM_TG}) b
		on
			a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
		where 
			1=1
			and b.juso is null
			and a.desc1 = #{JISA}
			and a.gover_own_yn = '사유지'
			and a.jisang_status = '미설정'
			and a.jisang_manage = 'N'
	</select>
	
	
	<!-- 통계 > 관리필지 증감현황 > 현황상세정보 메인 조회 > (기준년월, 비교년월) 분기 - 사유지 계 클릭 했을 때 -->
	<select id="selectFieldInDeStatusBoardListFieldPrivateProperty" parameterType="HashMap" resultType="HashMap">
		select
			a.desc1, a.juso, a.jisang_status
		from 
			(select * from static_deadline where year = #{YYYY_REF} and month = #{MM_REF}) a
		left join
			(select * from static_deadline where year = #{YYYY_TG} and month = #{MM_TG}) b
		on
			a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
		where 
			1=1
			and b.juso is null
			and a.desc1 = #{JISA}
			and a.gover_own_yn = '사유지'
			and a.jisang_status not in ('점용','회사토지')
			and a.jisang_manage = 'N'
	</select>
	
	
	<!-- 통계 > 관리필지 증감현황 > 현황상세정보 메인 조회 > (기준년월, 비교년월) 분기 - 국유지 지상권 클릭 했을 때 -->
	<select id="selectFieldInDeStatusBoardListPublicJisang" parameterType="HashMap" resultType="HashMap">
		select
			a.desc1, a.juso, a.jisang_status
		from 
			(select * from static_deadline where year = #{YYYY_REF} and month = #{MM_REF}) a
		left join
			(select * from static_deadline where year = #{YYYY_TG} and month = #{MM_TG}) b
		on
			a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
		where 
			1=1
			and b.juso is null
			and a.desc1 = #{JISA}
			and a.gover_own_yn = '국유지'
			<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(JISANG_STATUS)" > 
				and jisang_status = #{JISANG_STATUS} //  지상권, 점용, 미설정, ""(제거시 전체)
			</if>
			and a.jisang_manage = 'N'
	</select>
	
	
	
	<!-- 통계 > 관리필지 증감현황 > 현황상세정보 메인 조회 > (기준년월, 비교년월) 분기 - 합계 클릭 했을 때 -->
	<select id="selectFieldInDeStatusBoardListBungiSum" parameterType="HashMap" resultType="HashMap">
		select
			a.desc1, a.juso, a.jisang_status
		from 
			(select * from static_deadline where year = #{YYYY_REF} and month = #{MM_REF}) a
		left join
			(select * from static_deadline where year = #{YYYY_TG} and month = #{MM_TG}) b
		on
			a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
		where 
			1=1
			and b.juso is null
			and a.desc1 = #{JISA}
			and not(a.gover_own_yn = '사유지'
				and a.jisang_status = '점용')
			and a.jisang_manage = 'N'
	</select>

	<!-- 통계 > 관리필지 증감현황 > 현황상세정보 > 변동사유 > 메인 조회 -->
	<select id="selectFieldInDeStatusBoardChangeList" parameterType="HashMap" resultType="HashMap">
		with
			all_tb as (
				select desc1,desc1_num 
				from static_deadline_info group by desc1,desc1_num),
			ref_tb as (select * from static_deadline where year = #{YYYY_REF} and month = #{MM_REF} and desc1 is not null), --기준년월
			tg_tb as (select * from static_deadline where year = #{YYYY_TG} and month = #{MM_TG} and desc1 is not null), --비교년월
			del_tb as (
				select 
				a.jisang_no,a.desc1,a.juso,a.jibun, a.jisang_status, b.jisang_status as jisang_status_new,b.juso as juso_new
				from	
				ref_tb a
				left join
				tg_tb b
				on
				a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
				where 
				1=1
				and a.jisang_status = '지상권'
				and b.juso is null
			)
			,add_tb as (
				select 
				a.jisang_no,a.desc1,a.juso, a.jisang_status,a.jibun, b.jisang_status as jisang_status_new,b.juso as juso_new
				from	
				tg_tb a
				left join
				ref_tb b
				on
				a.sido_nm = b.sido_nm and a.sgg_nm= b.sgg_nm and a.emd_nm = b.emd_nm and a.ri_nm = b.ri_nm and a.jibun = b.jibun
				where 
				1=1
				and a.jisang_status = '지상권'
				and b.juso is null
			)
			,del_tb_fin as (
				select 
				*
				from (
				select
					a.*,
					case
						when b.jm_cancle_yn = 'Y' then '해지'
						when b.jm_bunhal_yn = 'Y' then '분할'
						when c.jm_jisang_no is not null then '합필'
						when a.jibun = d.jibun then '명칭변경'
						else '권리전환'
					end as gubun_del
				from 
					del_tb a
				left join
					jisang_master b
				on
					a.jisang_no =	b.jm_jisang_no 
				left join 
					jisang_merge c
				on
					a.jisang_no = c.jm_jisang_no 
				left join 
					tg_tb d
				on
					a.jisang_no = d.jisang_no
				) t1
				where 
				gubun_del <![CDATA[<>]]> '명칭변경'
			)
			,add_tb_fin as (
			select 
				*
			from
				(select
				a.*,
				case 
					when b.jm_bunhal_org_no <![CDATA[<>]]> '' and b.jm_bunhal_org_no is not null then '분할'
					when a.jibun = c.jibun then '명칭변경'
					when a.jibun <![CDATA[<>]]> c.jibun then '권리전환'
					else '사유지'
				end as gubun_add
				from 
				add_tb a
				left join
				jisang_master b
				on
				a.jisang_no = b.jm_jisang_no
				left join 
				ref_tb c
				on
				a.jisang_no = c.jisang_no
				) t1
			where gubun_add <![CDATA[<>]]> '명칭변경'
			),
			del_bunhal as (select desc1,count(*) from del_tb_fin where gubun_del = '분할' group by desc1),
			del_cancle as (select desc1,count(*) from del_tb_fin where gubun_del = '해지' group by desc1),
			del_merge as (select desc1,count(*) from del_tb_fin where gubun_del = '합필' group by desc1),
			del_change as (select desc1,count(*) from del_tb_fin where gubun_del = '권리전환' group by desc1),
			del_all as (select desc1,count(*) from del_tb_fin group by desc1),
			add_bunhal as (select desc1,count(*) from add_tb_fin where gubun_add = '분할' group by desc1),
			add_priv as (select desc1,count(*) from add_tb_fin where gubun_add = '사유지' group by desc1),
			add_merge as (select desc1,count(*) from add_tb_fin where gubun_add = '권리전환' group by desc1),
			add_all as (select desc1,count(*) from add_tb_fin group by desc1),
			fin as (select
				a.desc1,
				coalesce(b.count,'0') as del_bunhal_cnt,
				coalesce(c.count,'0') as del_cancle_cnt,
				coalesce(d.count,'0') as del_merge_cnt,
				coalesce(e.count,'0') as del_change_cnt,
				coalesce(f.count,'0') as del_all_cnt,		
				coalesce(g.count,'0') as add_bunhal_cnt,
				coalesce(h.count,'0') as add_priv_cnt,
				coalesce(i.count,'0') as add_merge_cnt,
				coalesce(j.count,'0') as add_all_cnt	
			from
				all_tb a 
			left join del_bunhal b on a.desc1 = b.desc1
			left join del_cancle c on a.desc1 = c.desc1
			left join del_merge d on a.desc1 = d.desc1
			left join del_change e on a.desc1 = e.desc1
			left join del_all f on a.desc1 = f.desc1
			left join add_bunhal g on a.desc1 = g.desc1
			left join add_priv h on a.desc1 = h.desc1
			left join add_merge i on a.desc1 = i.desc1
			left join add_all j on a.desc1 = j.desc1
			order by a.desc1_num),
			fin_1 as (
				select
					*,
					(add_all_cnt - del_all_cnt) as bunhal_dif --
				from fin
			)
			select * from fin_1
			union all
			select 
				'계' as desc1,
				sum(del_bunhal_cnt),
				sum(del_cancle_cnt),
				sum(del_merge_cnt),
				sum(del_change_cnt),
				sum(del_all_cnt),	
				sum(add_bunhal_cnt),
				sum(add_priv_cnt),
				sum(add_merge_cnt),
				sum(add_all_cnt),
				sum(bunhal_dif)
			from fin_1;
	</select>


	
		
		
	<select id="selectMinwonStatusStatic" parameterType="HashMap" resultType="HashMap">
			SELECT 
		    mm.mm_jisa,
		    COUNT(*) AS total_count, 
		    COUNT(*) FILTER (WHERE mm.mm_status = '1') AS status_1_count,
		    '임시저장' AS status_1_title,
		    COUNT(*) FILTER (WHERE mm.mm_status = '2') AS status_2_count,
		    '민원발생' AS status_2_title,
		    COUNT(*) FILTER (WHERE mm.mm_status = '3') AS status_3_count,
		    '대응방안수립' AS status_3_title,
		    COUNT(*) FILTER (WHERE mm.mm_status = '4') AS status_4_count,
		    '협의중' AS status_4_title,
		    COUNT(*) FILTER (WHERE mm.mm_status = '5') AS status_5_count,
		    '완료' AS status_5_title
		FROM minwon_master mm
		where 1=1
		 <if test="jisaList != null and jisaList.size > 0">
			and mm.mm_jisa in 
			 <foreach item="jisa" index="index" collection="jisaList" open="(" separator="," close=")">
        		#{jisa}
    		</foreach>
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(status)" > 
		and mm.mm_status=#{status}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(occurDate)" > 
		AND TO_CHAR(mm.mm_occur_date, 'YYYY-MM') = #{occurDate}
		</if>
		GROUP BY mm.mm_jisa
		ORDER BY mm.mm_jisa
	
	</select>
	
	<!-- 권리확보현황 마감관리 조회 -->
	<select id="selectStatisticsDeadlineData" parameterType="HashMap" resultType="HashMap">
    <![CDATA[
    SELECT T.* 
    FROM (
        SELECT ROW_NUMBER() OVER (ORDER BY SEQ DESC) AS RN,
               SEQ,
               SAVE_YEAR,
               SAVE_QUARTER,
               SAVE_DATE::date as SAVE_DATE,
               SAYUJI_N,
               SAYUJI_Y_Y,
               SAYUJI_Y_N,
               SAYUJI_TOTAL,
               GUKYUJI_J,
               GUKYUJI_Y,
               GUKYUJI_N,
               GUKYUJI_TOTAL,
               PROCESS_DATE,
               FILE_PATH,
               FILE_NAME
          FROM JISANG_STAT 
         WHERE 1 = 1 
    ]]>
    <if test="SAVE_YEAR != null and SAVE_YEAR != ''">
        AND SAVE_YEAR = #{SAVE_YEAR}
    </if>
    <if test="SAVE_QUARTER != null and SAVE_QUARTER != ''">
        AND SAVE_QUARTER = #{SAVE_QUARTER}
    </if>
    <![CDATA[
         ORDER BY SEQ DESC
    ) T
    WHERE 1 = 1 
    ]]>
    <if test="PAGE_NUM != null and PAGE_NUM != ''">
        AND T.RN BETWEEN ((#{PAGE_CNT} * (#{PAGE_NUM} - 1)) + 1) AND (#{PAGE_CNT} * #{PAGE_NUM})
    </if>
</select>

<select id="selectStatisticsDeadlineDataCnt" parameterType="HashMap" resultType="Integer">
    <![CDATA[
    SELECT COUNT(*) 
      FROM JISANG_STAT 
     WHERE 1 = 1 
    ]]>
    <if test="SAVE_YEAR != null and SAVE_YEAR != ''">
        AND SAVE_YEAR = #{SAVE_YEAR}
    </if>
    <if test="SAVE_QUARTER != null and SAVE_QUARTER != ''">
        AND SAVE_QUARTER = #{SAVE_QUARTER}
    </if>
</select>



</mapper>