<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="jisangSQL">
<select id="selectAllList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		select * from jisang_master jm LEFT JOIN jisang_souja js ON js.js_jisang_no=jm.jm_jisang_no
		where 1=1
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(idx)" >
		and jm.jm_jisang_no=#{idx}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(index)" >
		and jm_idx=cast(${index} as varchar)
		</if>
	</select>
	<select id="selectAllData" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		select *
		,concat(jm_sido_nm,' ',jm_sgg_nm,' ',jm_ri_nm,' ',jm_jibun) as address
		from jisang_master 
		where 1=1
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(idx)" >
		and jm_jisang_no=#{idx}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(index)" >
		and jm_idx=cast(#{index} as integer)
		</if>
		
	</select>
	<select id="selectSoyujaData" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		select *,(row_number() over()) as no 
		from jisang_souja 
		where 1=1
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(idx)" >
		and js_jisang_no=#{idx}
		</if>
		
		
	</select>
	
	<select id="selectPermitList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		select *,(row_number() over()) as no 
		from jisang_master jm left join jisang_permit_master jpm on jpm.jpm_dockey=jm.jm_dockey
		where 1=1
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(idx)" >
		and jm.jm_jisang_no=#{idx}
		</if>
			AND jm.jm_dockey IS NOT null
		AND jpm.jpm_dockey IS NOT null
		
		
	</select>
	
	
	<select id="selectAtcFileList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		select *,(row_number() over()) as no 
		from jisang_atcfile 
		where 1=1
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(idx)" >
		and ja_jisang_no=#{idx}
		</if>
		
		
	</select>
	
	<select id="selectModifyList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		select *,(row_number() over()) as no 
		from jisang_modify 
		where 1=1
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(idx)" >
		and jm_jisang_no=#{idx}
		</if>
			
	</select>
	<select id="selectMergeList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		select *,(row_number() over()) as no 
		from jisang_merge 
		where 1=1
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(idx)" >
		and jm_jisang_no=#{idx}
		</if>
			
	</select>
	<select id="selectIssueList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		select (row_number() over()) as NO
		 , to_char(pi_issue_date,'YYYY-MM-DD HH:MM:SS') as issue_date
		 ,*
		  FROM potential_issue PI
		  LEFT JOIN 
		  (
		
				SELECT 
				jm.jm_jisang_no AS manage_no
				,COALESCE(jm.jm_comple_yn,'') AS comple_yn
				,COALESCE(jm.jm_permitted_yn,'') AS permitted_yn
				,SUBSTRING(jm.jm_jisang_no,1,1) AS rtype
				 FROM jisang_master jm
				 
				 UNION all
				 
				 
					SELECT 
				gm.gm_gover_no AS manage_no
				,COALESCE('','') AS comple_yn
				,COALESCE('','') AS permitted_yn
				,SUBSTRING(gm.gm_gover_no,1,1) AS rtype
				
				 FROM gover_master gm
				 
				 UNION all
				 
				 	SELECT 
				nm.nm_notset_no AS manage_no
				,COALESCE('','') AS comple_yn
				,COALESCE('','') AS permitted_yn
				,SUBSTRING(nm.nm_notset_no,1,1) AS rtype
				 FROM notset_master nm
		 
		 ) AS u
		 ON PI.pi_manage_no = u.manage_no
		 WHERE 1=1
		
		and pi_pnu=#{pnu}
			
	</select>
	<select id="selectIssueHistoryList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT *,(row_number() over()) as no 
		 FROM  potential_issue pi left join potential_issue_history pih on pi.pi_pnu=pih.pih_pnu 
		WHERE 1=1
		and pih_pnu=#{pnu}
		
			
	</select>
	
	<select id="selectPnuAtcFileList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		select *,(row_number() over()) as no 
		from pnu_atcfile 
		where 1=1
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(idx)" >
		and pa_manage_no=#{idx}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(pnu)" >
		and pa_pnu=#{pnu}
		</if>
	</select>
	
	
	<select id="selectIssueCodeAtcFileList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		select *,(row_number() over()) as no 
		from issue_code_atc_file 
		where 1=1
		
		and icaf_code in (#{issueManualCode1},#{issueManualCode2},#{issueManualCode3})
		
			
	</select>
	
	<!-- selectBasicSearchList 지적정보에서 검색-->
	<select id="selectBasicSearchList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		select *,(row_number() over()) as no 
		FROM jisang_master jm LEFT JOIN jijuk_master_2022 jm2 ON jm2.pnu=jm.jm_pnu
		WHERE 1=1
		AND jm2.pnu IS NOT null
		
			
	</select>
	<select id="selectAllList2" parameterType="java.util.HashMap" resultType="java.util.HashMap"><![CDATA[
		select jm_set_money,jm_save_status from jisang_master 
	]]></select>

	<select id="selectJisangList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT *,
		(row_number() OVER()) AS no
		FROM (
		SELECT jm.jm_idx AS index,
		jm.jm_jisang_no AS idx,
		0 AS gidx,
		jm.jm_jisa AS jisa,
		jm.jm_save_status AS save_status,
		jm.jm_account_yn AS account_yn,
		jm.jm_cancel_date AS cancel_date,
		COALESCE(jm.jm_pipe_yn, 'N') AS pipe_yn,
		jm.jm_toji_type AS toji_type,
		jm.jm_pipe_meter AS pipe_meter,
		jm.jm_jimok_text AS jimok_text,
		js.js_souja_name AS souja_name,
		COALESCE(jm.jm_jijuk_area, NULL) AS jijuk_area,
		COALESCE(jm.jm_pyeonib_area, NULL) AS pyeonib_area,
		jm.jm_sido_nm AS sido_nm,
		jm.jm_sgg_nm AS sgg_nm,
		jm.jm_emd_nm AS emd_nm,
		jm.jm_ri_nm AS ri_nm,
		jm.jm_jibun AS jibun,
		jm.jm_deunggi_date AS deunggi_date,
		TRIM(CONCAT(jm.jm_sido_nm, ' ', jm.jm_sgg_nm, ' ', jm.jm_ri_nm, ' ', jm.jm_jibun)) AS address,
		COALESCE(jm.jm_jasan_no, '') AS jasan_no,
		COALESCE(jm.jm_comple_yn, '') AS comple_yn,
		COALESCE(jm.jm_permitted_yn, '') AS permitted_yn,
		COALESCE(jm.jm_chuideuk_date, NULL) AS chuideuk_date,
		COALESCE('', '') AS gover_date,
		NULL AS pay_date,
		NULL AS gover_area,
		NULL AS gover_length,
		jm.jm_jasan_money AS jasan_money,
		NULL AS pay_money,
		jm.jm_cancel_yn AS cancel_yn,
		jm.jm_manage_yn AS manage_yn,
		jm.jm_dosiplan AS dosiplan,
		CASE
		WHEN (SELECT count(dm.dm_idx) FROM dosi_master dm WHERE dm.dm_pnu = jm.jm_pnu) > 0 THEN 'Y'
		WHEN (SELECT count(dm.dm_idx) FROM dosi_master dm WHERE dm.dm_pnu = jm.jm_pnu) = 0 THEN 'N'
		END AS toji_plan
		FROM jisang_master jm
		LEFT JOIN jisang_souja js ON js.js_jisang_no = jm.jm_jisang_no
		WHERE 1 = 1
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(jisa)" >
			and jm.jm_jisa=#{jisa}
		</if>
		) AS r
		where 1=1
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(idx)" >
			and r.idx=#{idx}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(cancelYn)" >
			and r.cancel_yn=#{cancelYn}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(manageYn)" >
			and r.manage_yn=#{manageYn}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(dosiplan)" >
			and r.dosiplan=#{dosiplan}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(address)" >
			and r.address like '${address}%'
		</if>
		<if test="@com.slsolution.plms.common.CmCodeService@isNotEmpty(right_type)" >
			and r.right_type in <foreach item="item" index="index" collection="right_type" open="(" separator="," close=")">#{item}</foreach>
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(toji_plan_type)" >
			and r.toji_plan=#{toji_plan_type}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(toji_type)" >
			and r.toji_type=#{toji_type}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(right_overlap)" >
			and (SELECT COUNT(o.address) AS overlap
			FROM
			(
			(
			SELECT trim(concat(jm.jm_sido_nm,' ',jm.jm_sgg_nm,' ',jm.jm_ri_nm,' ',jm.jm_jibun)) as address
			FROM jisang_master jm LEFT JOIN jisang_souja js ON js.js_jisang_no=jm.jm_jisang_no
			where 1=1

			)
			) as o  WHERE o.address = r.address GROUP BY o.address ) >1
		</if>

		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(orderCol)" >
			ORDER BY r.${orderCol} ${desc}
		</if>
		<if test="length>0">
			limit #{length} offset #{start}
		</if>

	</select>

	<select id="selectTotalCount" parameterType="java.util.HashMap" resultType="Integer">
		SELECT count(*) as count FROM (
		SELECT jm.jm_idx AS index,
		jm.jm_jisang_no AS idx,
		0 AS gidx,
		jm.jm_jisa AS jisa,
		jm.jm_save_status AS save_status,
		jm.jm_account_yn AS account_yn,
		jm.jm_cancel_date AS cancel_date,
		COALESCE(jm.jm_pipe_yn, 'N') AS pipe_yn,
		jm.jm_toji_type AS toji_type,
		jm.jm_pipe_meter AS pipe_meter,
		jm.jm_jimok_text AS jimok_text,
		js.js_souja_name AS souja_name,
		COALESCE(jm.jm_jijuk_area, NULL) AS jijuk_area,
		COALESCE(jm.jm_pyeonib_area, NULL) AS pyeonib_area,
		jm.jm_sido_nm AS sido_nm,
		jm.jm_sgg_nm AS sgg_nm,
		jm.jm_emd_nm AS emd_nm,
		jm.jm_ri_nm AS ri_nm,
		jm.jm_jibun AS jibun,
		jm.jm_deunggi_date AS deunggi_date,
		TRIM(CONCAT(jm.jm_sido_nm, ' ', jm.jm_sgg_nm, ' ', jm.jm_ri_nm, ' ', jm.jm_jibun)) AS address,
		COALESCE(jm.jm_jasan_no, '') AS jasan_no,
		COALESCE(jm.jm_comple_yn, '') AS comple_yn,
		COALESCE(jm.jm_permitted_yn, '') AS permitted_yn,
		COALESCE(jm.jm_chuideuk_date, NULL) AS chuideuk_date,
		COALESCE('', '') AS gover_date,
		NULL AS pay_date,
		NULL AS gover_area,
		NULL AS gover_length,
		jm.jm_jasan_money AS jasan_money,
		NULL AS pay_money,
		jm.jm_cancel_yn AS cancel_yn,
		jm.jm_manage_yn AS manage_yn,
		jm.jm_dosiplan AS dosiplan,
		CASE
		WHEN (SELECT count(dm.dm_idx) FROM dosi_master dm WHERE dm.dm_pnu = jm.jm_pnu) > 0 THEN 'Y'
		WHEN (SELECT count(dm.dm_idx) FROM dosi_master dm WHERE dm.dm_pnu = jm.jm_pnu) = 0 THEN 'N'
		END AS toji_plan
		FROM jisang_master jm
		LEFT JOIN jisang_souja js ON js.js_jisang_no = jm.jm_jisang_no
		WHERE 1 = 1
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(jisa)" >
			and nm.nm_jisa=#{jisa}
		</if>
		) AS r
		where 1=1
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(idx)" >
			and r.idx=#{idx}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(cancelYn)" >
			and r.cancel_yn=#{cancelYn}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(manageYn)" >
			and r.manage_yn=#{manageYn}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(dosiplan)" >
			and r.dosiplan=#{dosiplan}
		</if>
		<if test="@com.slsolution.plms.common.CmCodeService@isNotEmpty(right_type)" >
			and r.right_type in <foreach item="item" index="index" collection="right_type" open="(" separator="," close=")">#{item}</foreach>
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(address)" >
			and r.address like '${address}%'
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(toji_plan_type)" >
			and r.toji_plan=#{toji_plan_type}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(right_overlap)" >
			and (SELECT COUNT(o.address) AS overlap
			FROM
			(
			(
			SELECT trim(concat(jm.jm_sido_nm,' ',jm.jm_sgg_nm,' ',jm.jm_ri_nm,' ',jm.jm_jibun)) as address
			FROM jisang_master jm LEFT JOIN jisang_souja js ON js.js_jisang_no=jm.jm_jisang_no
			where 1=1
			)

			) as o  WHERE o.address = r.address GROUP BY o.address ) >1
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(toji_type)" >
			and r.toji_type=#{toji_type}
		</if>
	</select>
</mapper>