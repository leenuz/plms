<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="notiSQL">

	<!-- 이설공사 확인 필지 count-->
	<select id="selectNotiTotalCount" parameterType="java.util.HashMap" resultType="int">
    SELECT
		   COUNT(*) as total_count
		FROM pl_mv_jijuk
		WHERE 1=1
		   AND del_flag='N'
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(jisa)">
		 AND desc1 = #{jisa}
		 </if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(gubun)" >
			and gubun=#{gubun}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(juso)" >
		and juso like '%${juso}%'
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(sido_nm)" >
			and sido_nm = #{sido_nm}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(sgg_nm)" >
			and sgg_nm = #{sgg_nm}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(emd_nm)" >
			and emd_nm = #{emd_nm}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(ri_nm)" >
			and ri_nm = #{ri_nm}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(jibun)" >
			and jibun LIKE '%${jibun}%'
		</if>
	</select>
	
	<!-- 이설공사 확인 필지 조회 -->
  <select id="selectNotiAllList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
     SELECT
	    ROW_NUMBER() OVER(ORDER BY mv_date DESC) as no,
		 	id,
		  desc1 AS jisa,
		  juso,
		  jimok_text,
		  jijuk_area,
		  zone_name,
		  CASE 
		    WHEN gubun= 'N' then '신규대상'
		  	ELSE '해지대상'
		  END AS gubun,
			mv_date,
			x,
			y
		FROM pl_mv_jijuk
		WHERE 1=1
	  AND del_flag='N'
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(jisa)">
		 AND desc1 = #{jisa}
		 </if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(gubun)" >
			and gubun = #{gubun}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(juso)" >
		and juso like '%${juso}%'
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(sido_nm)" >
			and sido_nm = #{sido_nm}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(sgg_nm)" >
			and sgg_nm = #{sgg_nm}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(emd_nm)" >
			and emd_nm = #{emd_nm}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(ri_nm)" >
			and ri_nm = #{ri_nm}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(jibun)" >
			and jibun LIKE '%${jibun}%'
		</if>
		
    <if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(orderCol)" >
			ORDER BY AA.${orderCol} ${desc}
			</if>
		<if test="length>0">
			limit #{length} offset #{start}
		</if>
  </select>
  
  <update id="deleteJijuk" parameterType="java.util.HashMap">
    UPDATE pl_mv_jijuk
    SET del_flag = 'Y',
        update_date = now()
    WHERE id = #{id}
	</update>

</mapper>