<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="dopcoSQL">
<select id="selectTotalCount" parameterType="java.util.HashMap" resultType="Integer">
		select count(*) from (
		SELECT *,
		TRIM(CONCAT(dom.dom_sido_nm, ' ', dom.dom_sgg_nm, ' ',dom.dom_emd_nm,' ',dom.dom_ri_nm, ' ', dom.dom_jibun)) AS address,
		FROM dopco_master dom
		
		WHERE 1 = 1
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(jisa)" >
			and dom.dom_jisa=#{jisa}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(jasan_no)" >
			and dom.dom_jasan_no like '%${jasan_no}%'
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(start_date) and @org.apache.commons.lang3.ObjectUtils@isNotEmpty(end_date)" >
			and dom.dom_chuideuk_date::date between #{start_date}::date and #{end_date}::date
		</if>
		) r
		where 1=1
		
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(address)" >
			and r.address like '%${address}%'
		</if>
		
		
	</select>
	<select id="selectDopcoList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		
		select * from (
		SELECT *,
		TRIM(CONCAT(dom.dom_sido_nm, ' ', dom.dom_sgg_nm, ' ',dom.dom_emd_nm,' ',dom.dom_ri_nm, ' ', dom.dom_jibun)) AS address,
		FROM dopco_master dom
		
		WHERE 1 = 1
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(jisa)" >
			and dom.dom_jisa=#{jisa}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(jasan_no)" >
			and dom.dom_jasan_no like '%${jasan_no}%'
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(start_date) and @org.apache.commons.lang3.ObjectUtils@isNotEmpty(end_date)" >
			and dom.dom_chuideuk_date::date between #{start_date}::date and #{end_date}::date
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(orderCol)" >
			ORDER BY ${orderCol} ${desc}
		</if>
		) r
		where 1=1
		
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(address)" >
			and r.address like '%${address}%'
		</if>
		<if test="length>0">
			limit #{length} offset #{start}
		</if>
		
		
		

	</select>
	<select id="selectAllData" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		select *
		,concat(dom_sido_nm,' ',dom_sgg_nm,' ',dom_emd_nm,' ',dom_ri_nm,' ',dom_jibun) as address
		from dopco_master 
		where 1=1
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(idx)" >
		and dom_dopco_no=#{idx}
		</if>
		
	</select>
	
	
	<select id="selectcancelTotalCount" parameterType="java.util.HashMap" resultType="Integer">
		select count(*) from (
		SELECT *,
		TRIM(CONCAT(dom.dom_sido_nm, ' ', dom.dom_sgg_nm, ' ',dom.dom_emd_nm,' ',dom.dom_ri_nm, ' ', dom.dom_jibun)) AS address,
		FROM dopco_master dom
		
		WHERE 1 = 1
		
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(jisa)" >
			and dom.dom_jisa=#{jisa}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(jasan_no)" >
			and dom.dom_jasan_no like '%${jasan_no}%'
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(cancel_yn)" >
			and dom.dom_cancel_yn =#{cancel_yn}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(start_date) and @org.apache.commons.lang3.ObjectUtils@isNotEmpty(end_date)" >
			and dom.dom_chuideuk_date::date between #{start_date}::date and #{end_date}::date
		</if>
		) r
		where 1=1
		
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(address)" >
			and r.address like '%${address}%'
		</if>
		
		
	</select>
	<select id="selectDopcoCancelList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		
		select * from (
		SELECT *,
		TRIM(CONCAT(dom.dom_sido_nm, ' ', dom.dom_sgg_nm, ' ',dom.dom_emd_nm,' ',dom.dom_ri_nm, ' ', dom.dom_jibun)) AS address,
		FROM dopco_master dom
		
		WHERE 1 = 1
		dom_cancel_date IS NOT null
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(jisa)" >
			and dom.dom_jisa=#{jisa}
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(jasan_no)" >
			and dom.dom_jasan_no like '%${jasan_no}%'
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(start_date) and @org.apache.commons.lang3.ObjectUtils@isNotEmpty(end_date)" >
			and dom.dom_chuideuk_date::date between #{start_date}::date and #{end_date}::date
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(orderCol)" >
			ORDER BY ${orderCol} ${desc}
		</if>
		) r
		where 1=1
		
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(address)" >
			and r.address like '%${address}%'
		</if>
		<if test="length>0">
			limit #{length} offset #{start}
		</if>
		
		
		

	</select>
	
	
	<insert id="insertDopcoMaster" parameterType="HashMap">
		Insert into DOPCO_MASTER
		( dm_DOPCO_NO, dm_SIDO_NM, dm_SGG_NM, dm_EMD_NM, dm_RI_NM, dm_JIBUN, dm_ADDRCODE
		, dm_JISA, dm_DOPCO_STATUS, dm_YONGDO, dm_PIPE_NAME, dm_SUN_GUBUN, dm_JIJUK_AREA
		, dm_GOVER_OWN_YN, dm_DOSIPLAN, dm_JASAN_NO, dm_COMPLE_YN, dm_DEUNGGI_DATE, dm_DEUNGGI_NO
		, dm_DEUNGGISO, dm_PNU, dm_JIMOK_TEXT, dm_CHUIDEUK_DATE )
		Values
		( #{DOPCO_NO}, #{SIDO_NM},#{SGG_NM},#{EMD_NM},#{RI_NM},#{JIBUN#},#{ADDRCODE}
		,#{JISA},#{DOPCO_STATUS},#{YONGDO},#{PIPE_NAME},#{SUN_GUBUN},#{JIJUK_AREA}
		,#{GOVEROWNYN},#{DOSIPLAN},#{JASANNO},#{COMPLE_YN},to_date(#{DEUNGGI_DATE},'yyyy-mm-dd'),#{DEUNGGI_NO}
		,#{DEUNGGISO},#{PNU},#{JIMOK_TEXT}, TO_DATE(#{CHUIDEUK_DATE}, 'yyyy-mm-dd') )
	</insert>
	<insert id="insertDopcoTojaOrder" parameterType="HashMap">
		Insert into DOPCO_TOJA
		( dt_DOPCO_NO, dt_TOJA_NO )
		Values
		( #{DOPCO_NO},#{TOJA} )
	</insert>
	<insert id="insertDopcoRight" parameterType="HashMap">
		Insert into DOPCO_RIGHT
		( dr_DOPCO_NO, dr_RIGHT_NAME, dr_RIGHT_MONEY
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(RIGHT_DATE)" >
			,dr_RIGHT_DATE
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(CANCLE_DATE)" >
			,dr_CANCLE_DATE
		</if>
		, dr_RIGHT_UNAME, dr_RIGHT_PHONE, dr_RIGHT_ADDR )
		Values
		( #{DOPCO_NO},#{RIGHT_NAME},#{RIGHT_MONEY}
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(RIGHT_DATE)" >
			, TO_DATE(#{RIGHT_DATE}, 'yyyy-mm-dd')
		</if>
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(CANCLE_DATE)" >
			, TO_DATE(#{CANCLE_DATE}, 'yyyy-mm-dd')
		</if>
		, #{RIGHT_UNAME},#{RIGHT_PHONE},#{RIGHT_ADDR} )
	</insert>
		<insert id="insertDopcoFile" parameterType="HashMap">
            
			INSERT INTO DOPCO_ATCFILE(da_DOPCO_NO, da_SEQ	, da_FILE_PATH, da_FILE_NM)
			VALUES (#{DOPCO_NO}, nextVal(dopco_atc_seq), #{FILE_PATH}, #{FILE_NM})
			
	</insert>
	<update id="updateDopcoMaster" parameterType="HashMap">
		UPDATE DOPCO_MASTER
		SET

		dm_SIDO_NM = #{SIDO_NM}
		, dm_SGG_NM = #{SGG_NM}
		, dm_EMD_NM = #{EMD_NM}
		, dm_RI_NM = #{RI_NM}
		, dm_JIBUN = #{JIBUN}
		, dm_ADDRCODE = #{ADDRCODE}
		, dm_JISA = #{JISA}
		, dm_DOPCO_STATUS = #{DOPCO_STATUS}
		, dm_YONGDO = #{YONGDO}
		, dm_PIPE_NAME = #{PIPE_NAME}
		, dm_SUN_GUBUN = #{SUN_GUBUN}
		, dm_JIJUK_AREA = #{JIJUKAREA}
		, dm_GOVER_OWN_YN = #{GOVEROWNYN}
		, dm_DOSIPLAN = #{DOSIPLAN}
		, dm_JASAN_NO = #{JASANNO}
		, dm_COMPLE_YN =#{COMPLE_YN}
		, dm_DEUNGGI_DATE = TO_DATE(#{DEUNGGI_DATE}, 'yyyy-mm-dd')
		, dm_DEUNGGI_NO = #{DEUNGGI_NO}
		, dm_DEUNGGISO = #{DEUNGGISO}
		, dm_PNU = #{IN_PNU}
		, dm_JIMOK_TEXT = #{JIMOK_TEXT}
		, dm_CHUIDEUK_DATE = TO_DATE(#{CHUIDEUK_DATE}, 'yyyy-mm-dd')

		WHERE dm_DOPCO_NO = #{DOPCO_NO}

	</update>
		<insert id="insertDopcoModifyHistory" parameterType="HashMap">
		Insert into DOPCO_MODIFY
		( dm_DOPCO_NO, dm_MODIFY_DATE, dm_GUBUN, dm_CONT, dm_USER_NAME, dm_USER_ID)
		Values
		(#{DOPCO_NO},Now(), #{GUBUN}, #{CONT}, #{USER_NAME}, #{USER_ID})
	</insert>
	
	<select id="selectDopcoNextNo" resultType="HashMap" parameterType="HashMap">
		SELECT COALESCE(MAX(CAST(SUBSTRING(dm_DOPCO_NO FROM 3) AS INTEGER)), 0) AS NOW_DOPCONO
		FROM DOPCO_MASTER;

	</select>
		<delete id="deleteDopcoRight" parameterType="HashMap">
		DELETE FROM DOPCO_RIGHT
		WHERE dr_DOPCO_NO = #{DOPCO_NO}
	</delete>
	
	<delete id="deleteFile_dopco" parameterType="HashMap">
		DELETE FROM DOPCO_ATCFILE
		WHERE da_DOPCO_NO = #{DOPCO_NO}
		<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(SEQ)" >
			AND da_FILE_SEQ = #{SEQ}
		</if>
	</delete>
	
	<update id="updateSeqFile_Dopco" parameterType="HashMap">
		UPDATE DOPCO_ATCFILE SET
		da_DOPCO_NO = #{DOPCO_NO}
		WHERE da_SEQ = #{FILESEQ}
	</update>
	
	
	
</mapper>